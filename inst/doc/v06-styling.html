<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Chris Bailiss" />

<meta name="date" content="2018-10-17" />

<title></title>

<script src="data:application/x-javascript;base64,KGZ1bmN0aW9uKCkgewogIC8vIElmIHdpbmRvdy5IVE1MV2lkZ2V0cyBpcyBhbHJlYWR5IGRlZmluZWQsIHRoZW4gdXNlIGl0OyBvdGhlcndpc2UgY3JlYXRlIGEKICAvLyBuZXcgb2JqZWN0LiBUaGlzIGFsbG93cyBwcmVjZWRpbmcgY29kZSB0byBzZXQgb3B0aW9ucyB0aGF0IGFmZmVjdCB0aGUKICAvLyBpbml0aWFsaXphdGlvbiBwcm9jZXNzICh0aG91Z2ggbm9uZSBjdXJyZW50bHkgZXhpc3QpLgogIHdpbmRvdy5IVE1MV2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cyB8fCB7fTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gYSB2aWV3ZXIgcGFuZS4gSWYgbm90LCB3ZSdyZSBpbiBhIHdlYiBicm93c2VyLgogIHZhciB2aWV3ZXJNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnZpZXdlck1vZGUgPQogICAgICAvXGJ2aWV3ZXJfcGFuZT0xXGIvLnRlc3Qod2luZG93LmxvY2F0aW9uKTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gU2hpbnkgbW9kZS4gSWYgbm90LCBpdCdzIGEgc3RhdGljIGRvY3VtZW50LgogIC8vIE5vdGUgdGhhdCBzdGF0aWMgd2lkZ2V0cyBjYW4gYXBwZWFyIGluIGJvdGggU2hpbnkgYW5kIHN0YXRpYyBtb2RlcywgYnV0CiAgLy8gb2J2aW91c2x5LCBTaGlueSB3aWRnZXRzIGNhbiBvbmx5IGFwcGVhciBpbiBTaGlueSBhcHBzL2RvY3VtZW50cy4KICB2YXIgc2hpbnlNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnNoaW55TW9kZSA9CiAgICAgIHR5cGVvZih3aW5kb3cuU2hpbnkpICE9PSAidW5kZWZpbmVkIiAmJiAhIXdpbmRvdy5TaGlueS5vdXRwdXRCaW5kaW5nczsKCiAgLy8gV2UgY2FuJ3QgY291bnQgb24galF1ZXJ5IGJlaW5nIGF2YWlsYWJsZSwgc28gd2UgaW1wbGVtZW50IG91ciBvd24KICAvLyB2ZXJzaW9uIGlmIG5lY2Vzc2FyeS4KICBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKHR5cGVvZihqUXVlcnkpICE9PSAidW5kZWZpbmVkIiAmJiBzY29wZSBpbnN0YW5jZW9mIGpRdWVyeSkgewogICAgICByZXR1cm4gc2NvcGUuZmluZChzZWxlY3Rvcik7CiAgICB9CiAgICBpZiAoc2NvcGUucXVlcnlTZWxlY3RvckFsbCkgewogICAgICByZXR1cm4gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhc0FycmF5KHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT09IG51bGwpCiAgICAgIHJldHVybiBbXTsKICAgIGlmICgkLmlzQXJyYXkodmFsdWUpKQogICAgICByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gW3ZhbHVlXTsKICB9CgogIC8vIEltcGxlbWVudCBqUXVlcnkncyBleHRlbmQKICBmdW5jdGlvbiBleHRlbmQodGFyZ2V0IC8qLCAuLi4gKi8pIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKHNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgdGFyZ2V0W3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9CgogIC8vIElFOCBkb2Vzbid0IHN1cHBvcnQgQXJyYXkuZm9yRWFjaC4KICBmdW5jdGlvbiBmb3JFYWNoKHZhbHVlcywgY2FsbGJhY2ssIHRoaXNBcmcpIHsKICAgIGlmICh2YWx1ZXMuZm9yRWFjaCkgewogICAgICB2YWx1ZXMuZm9yRWFjaChjYWxsYmFjaywgdGhpc0FyZyk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgdmFsdWVzW2ldLCBpLCB2YWx1ZXMpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZXBsYWNlcyB0aGUgc3BlY2lmaWVkIG1ldGhvZCB3aXRoIHRoZSByZXR1cm4gdmFsdWUgb2YgZnVuY1NvdXJjZS4KICAvLwogIC8vIE5vdGUgdGhhdCBmdW5jU291cmNlIHNob3VsZCBub3QgQkUgdGhlIG5ldyBtZXRob2QsIGl0IHNob3VsZCBiZSBhIGZ1bmN0aW9uCiAgLy8gdGhhdCBSRVRVUk5TIHRoZSBuZXcgbWV0aG9kLiBmdW5jU291cmNlIHJlY2VpdmVzIGEgc2luZ2xlIGFyZ3VtZW50IHRoYXQgaXMKICAvLyB0aGUgb3ZlcnJpZGRlbiBtZXRob2QsIGl0IGNhbiBiZSBjYWxsZWQgZnJvbSB0aGUgbmV3IG1ldGhvZC4gVGhlIG92ZXJyaWRkZW4KICAvLyBtZXRob2QgY2FuIGJlIGNhbGxlZCBsaWtlIGEgcmVndWxhciBmdW5jdGlvbiwgaXQgaGFzIHRoZSB0YXJnZXQgcGVybWFuZW50bHkKICAvLyBib3VuZCB0byBpdCBzbyAidGhpcyIgd2lsbCB3b3JrIGNvcnJlY3RseS4KICBmdW5jdGlvbiBvdmVycmlkZU1ldGhvZCh0YXJnZXQsIG1ldGhvZE5hbWUsIGZ1bmNTb3VyY2UpIHsKICAgIHZhciBzdXBlckZ1bmMgPSB0YXJnZXRbbWV0aG9kTmFtZV0gfHwgZnVuY3Rpb24oKSB7fTsKICAgIHZhciBzdXBlckZ1bmNCb3VuZCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc3VwZXJGdW5jLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTsKICAgIH07CiAgICB0YXJnZXRbbWV0aG9kTmFtZV0gPSBmdW5jU291cmNlKHN1cGVyRnVuY0JvdW5kKTsKICB9CgogIC8vIEFkZCBhIG1ldGhvZCB0byBkZWxlZ2F0b3IgdGhhdCwgd2hlbiBpbnZva2VkLCBjYWxscwogIC8vIGRlbGVnYXRlZS5tZXRob2ROYW1lLiBJZiB0aGVyZSBpcyBubyBzdWNoIG1ldGhvZCBvbgogIC8vIHRoZSBkZWxlZ2F0ZWUsIGJ1dCB0aGVyZSB3YXMgb25lIG9uIGRlbGVnYXRvciBiZWZvcmUKICAvLyBkZWxlZ2F0ZU1ldGhvZCB3YXMgY2FsbGVkLCB0aGVuIHRoZSBvcmlnaW5hbCB2ZXJzaW9uCiAgLy8gaXMgaW52b2tlZCBpbnN0ZWFkLgogIC8vIEZvciBleGFtcGxlOgogIC8vCiAgLy8gdmFyIGEgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2ExJyk7IH0KICAvLyAgIG1ldGhvZDI6IGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygnYTInKTsgfQogIC8vIH07CiAgLy8gdmFyIGIgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2IxJyk7IH0KICAvLyB9OwogIC8vIGRlbGVnYXRlTWV0aG9kKGEsIGIsICJtZXRob2QxIik7CiAgLy8gZGVsZWdhdGVNZXRob2QoYSwgYiwgIm1ldGhvZDIiKTsKICAvLyBhLm1ldGhvZDEoKTsKICAvLyBhLm1ldGhvZDIoKTsKICAvLwogIC8vIFRoZSBvdXRwdXQgd291bGQgYmUgImIxIiwgImEyIi4KICBmdW5jdGlvbiBkZWxlZ2F0ZU1ldGhvZChkZWxlZ2F0b3IsIGRlbGVnYXRlZSwgbWV0aG9kTmFtZSkgewogICAgdmFyIGluaGVyaXRlZCA9IGRlbGVnYXRvclttZXRob2ROYW1lXTsKICAgIGRlbGVnYXRvclttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGFyZ2V0ID0gZGVsZWdhdGVlOwogICAgICB2YXIgbWV0aG9kID0gZGVsZWdhdGVlW21ldGhvZE5hbWVdOwoKICAgICAgLy8gVGhlIG1ldGhvZCBkb2Vzbid0IGV4aXN0IG9uIHRoZSBkZWxlZ2F0ZWUuIEluc3RlYWQsCiAgICAgIC8vIGNhbGwgdGhlIG1ldGhvZCBvbiB0aGUgZGVsZWdhdG9yLCBpZiBpdCBleGlzdHMuCiAgICAgIGlmICghbWV0aG9kKSB7CiAgICAgICAgdGFyZ2V0ID0gZGVsZWdhdG9yOwogICAgICAgIG1ldGhvZCA9IGluaGVyaXRlZDsKICAgICAgfQoKICAgICAgaWYgKG1ldGhvZCkgewogICAgICAgIHJldHVybiBtZXRob2QuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9OwogIH0KCiAgLy8gSW1wbGVtZW50IGEgdmFndWUgZmFjc2ltaWxpZSBvZiBqUXVlcnkncyBkYXRhIG1ldGhvZAogIGZ1bmN0aW9uIGVsZW1lbnREYXRhKGVsLCBuYW1lLCB2YWx1ZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikgewogICAgICByZXR1cm4gZWxbImh0bWx3aWRnZXRfZGF0YV8iICsgbmFtZV07CiAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykgewogICAgICBlbFsiaHRtbHdpZGdldF9kYXRhXyIgKyBuYW1lXSA9IHZhbHVlOwogICAgICByZXR1cm4gZWw7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMgZm9yIGVsZW1lbnREYXRhOiAiICsKICAgICAgICBhcmd1bWVudHMubGVuZ3RoKTsKICAgIH0KICB9CgogIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzQ0NjE3MC9lc2NhcGUtc3RyaW5nLWZvci11c2UtaW4tamF2YXNjcmlwdC1yZWdleAogIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nLCAiXFwkJiIpOwogIH0KCiAgZnVuY3Rpb24gaGFzQ2xhc3MoZWwsIGNsYXNzTmFtZSkgewogICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgiXFxiIiArIGVzY2FwZVJlZ0V4cChjbGFzc05hbWUpICsgIlxcYiIpOwogICAgcmV0dXJuIHJlLnRlc3QoZWwuY2xhc3NOYW1lKTsKICB9CgogIC8vIGVsZW1lbnRzIC0gYXJyYXkgKG9yIGFycmF5LWxpa2Ugb2JqZWN0KSBvZiBIVE1MIGVsZW1lbnRzCiAgLy8gY2xhc3NOYW1lIC0gY2xhc3MgbmFtZSB0byB0ZXN0IGZvcgogIC8vIGluY2x1ZGUgLSBpZiB0cnVlLCBvbmx5IHJldHVybiBlbGVtZW50cyB3aXRoIGdpdmVuIGNsYXNzTmFtZTsKICAvLyAgIGlmIGZhbHNlLCBvbmx5IHJldHVybiBlbGVtZW50cyAqd2l0aG91dCogZ2l2ZW4gY2xhc3NOYW1lCiAgZnVuY3Rpb24gZmlsdGVyQnlDbGFzcyhlbGVtZW50cywgY2xhc3NOYW1lLCBpbmNsdWRlKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoaGFzQ2xhc3MoZWxlbWVudHNbaV0sIGNsYXNzTmFtZSkgPT0gaW5jbHVkZSkKICAgICAgICByZXN1bHRzLnB1c2goZWxlbWVudHNbaV0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiBvbihvYmosIGV2ZW50TmFtZSwgZnVuYykgewogICAgaWYgKG9iai5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgIG9iai5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuYywgZmFsc2UpOwogICAgfSBlbHNlIGlmIChvYmouYXR0YWNoRXZlbnQpIHsKICAgICAgb2JqLmF0dGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBvZmYob2JqLCBldmVudE5hbWUsIGZ1bmMpIHsKICAgIGlmIChvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcikKICAgICAgb2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jLCBmYWxzZSk7CiAgICBlbHNlIGlmIChvYmouZGV0YWNoRXZlbnQpIHsKICAgICAgb2JqLmRldGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICAvLyBUcmFuc2xhdGUgYXJyYXkgb2YgdmFsdWVzIHRvIHRvcC9yaWdodC9ib3R0b20vbGVmdCwgYXMgdXN1YWwgd2l0aAogIC8vIHRoZSAicGFkZGluZyIgQ1NTIHByb3BlcnR5CiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL3BhZGRpbmcKICBmdW5jdGlvbiB1bnBhY2tQYWRkaW5nKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mKHZhbHVlKSA9PT0gIm51bWJlciIpCiAgICAgIHZhbHVlID0gW3ZhbHVlXTsKICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMF0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzBdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDIpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDMpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDQpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzNdfTsKICAgIH0KICB9CgogIC8vIENvbnZlcnQgYW4gdW5wYWNrZWQgcGFkZGluZyBvYmplY3QgdG8gYSBDU1MgdmFsdWUKICBmdW5jdGlvbiBwYWRkaW5nVG9Dc3MocGFkZGluZ09iaikgewogICAgcmV0dXJuIHBhZGRpbmdPYmoudG9wICsgInB4ICIgKyBwYWRkaW5nT2JqLnJpZ2h0ICsgInB4ICIgKyBwYWRkaW5nT2JqLmJvdHRvbSArICJweCAiICsgcGFkZGluZ09iai5sZWZ0ICsgInB4IjsKICB9CgogIC8vIE1ha2VzIGEgbnVtYmVyIHN1aXRhYmxlIGZvciBDU1MKICBmdW5jdGlvbiBweCh4KSB7CiAgICBpZiAodHlwZW9mKHgpID09PSAibnVtYmVyIikKICAgICAgcmV0dXJuIHggKyAicHgiOwogICAgZWxzZQogICAgICByZXR1cm4geDsKICB9CgogIC8vIFJldHJpZXZlcyBydW50aW1lIHdpZGdldCBzaXppbmcgaW5mb3JtYXRpb24gZm9yIGFuIGVsZW1lbnQuCiAgLy8gVGhlIHJldHVybiB2YWx1ZSBpcyBlaXRoZXIgbnVsbCwgb3IgYW4gb2JqZWN0IHdpdGggZmlsbCwgcGFkZGluZywKICAvLyBkZWZhdWx0V2lkdGgsIGRlZmF1bHRIZWlnaHQgZmllbGRzLgogIGZ1bmN0aW9uIHNpemluZ1BvbGljeShlbCkgewogICAgdmFyIHNpemluZ0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vaHRtbHdpZGdldC1zaXppbmcnXSIpOwogICAgaWYgKCFzaXppbmdFbCkKICAgICAgcmV0dXJuIG51bGw7CiAgICB2YXIgc3AgPSBKU09OLnBhcnNlKHNpemluZ0VsLnRleHRDb250ZW50IHx8IHNpemluZ0VsLnRleHQgfHwgInt9Iik7CiAgICBpZiAodmlld2VyTW9kZSkgewogICAgICByZXR1cm4gc3Audmlld2VyOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHNwLmJyb3dzZXI7CiAgICB9CiAgfQoKICAvLyBAcGFyYW0gdGFza3MgQXJyYXkgb2Ygc3RyaW5ncyAob3IgZmFsc3kgdmFsdWUsIGluIHdoaWNoIGNhc2Ugbm8tb3ApLgogIC8vICAgRWFjaCBlbGVtZW50IG11c3QgYmUgYSB2YWxpZCBKYXZhU2NyaXB0IGV4cHJlc3Npb24gdGhhdCB5aWVsZHMgYQogIC8vICAgZnVuY3Rpb24uIE9yLCBjYW4gYmUgYW4gYXJyYXkgb2Ygb2JqZWN0cyB3aXRoICJjb2RlIiBhbmQgImRhdGEiCiAgLy8gICBwcm9wZXJ0aWVzOyBpbiB0aGlzIGNhc2UsIHRoZSAiY29kZSIgcHJvcGVydHkgc2hvdWxkIGJlIGEgc3RyaW5nCiAgLy8gICBvZiBKUyB0aGF0J3MgYW4gZXhwciB0aGF0IHlpZWxkcyBhIGZ1bmN0aW9uLCBhbmQgImRhdGEiIHNob3VsZCBiZQogIC8vICAgYW4gb2JqZWN0IHRoYXQgd2lsbCBiZSBhZGRlZCBhcyBhbiBhZGRpdGlvbmFsIGFyZ3VtZW50IHdoZW4gdGhhdAogIC8vICAgZnVuY3Rpb24gaXMgY2FsbGVkLgogIC8vIEBwYXJhbSB0YXJnZXQgVGhlIG9iamVjdCB0aGF0IHdpbGwgYmUgInRoaXMiIGZvciBlYWNoIGZ1bmN0aW9uCiAgLy8gICBleGVjdXRpb24uCiAgLy8gQHBhcmFtIGFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIGJlIHBhc3NlZCB0byB0aGUgZnVuY3Rpb25zLiAoVGhlCiAgLy8gICBzYW1lIGFyZ3VtZW50cyB3aWxsIGJlIHBhc3NlZCB0byBhbGwgZnVuY3Rpb25zLikKICBmdW5jdGlvbiBldmFsQW5kUnVuKHRhc2tzLCB0YXJnZXQsIGFyZ3MpIHsKICAgIGlmICh0YXNrcykgewogICAgICBmb3JFYWNoKHRhc2tzLCBmdW5jdGlvbih0YXNrKSB7CiAgICAgICAgdmFyIHRoZXNlQXJncyA9IGFyZ3M7CiAgICAgICAgaWYgKHR5cGVvZih0YXNrKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgIHRoZXNlQXJncyA9IHRoZXNlQXJncy5jb25jYXQoW3Rhc2suZGF0YV0pOwogICAgICAgICAgdGFzayA9IHRhc2suY29kZTsKICAgICAgICB9CiAgICAgICAgdmFyIHRhc2tGdW5jID0gZXZhbCgiKCIgKyB0YXNrICsgIikiKTsKICAgICAgICBpZiAodHlwZW9mKHRhc2tGdW5jKSAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUYXNrIG11c3QgYmUgYSBmdW5jdGlvbiEgU291cmNlOlxuIiArIHRhc2spOwogICAgICAgIH0KICAgICAgICB0YXNrRnVuYy5hcHBseSh0YXJnZXQsIHRoZXNlQXJncyk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdFNpemluZyhlbCkgewogICAgdmFyIHNpemluZyA9IHNpemluZ1BvbGljeShlbCk7CiAgICBpZiAoIXNpemluZykKICAgICAgcmV0dXJuOwoKICAgIHZhciBjZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaHRtbHdpZGdldF9jb250YWluZXIiKTsKICAgIGlmICghY2VsKQogICAgICByZXR1cm47CgogICAgaWYgKHR5cGVvZihzaXppbmcucGFkZGluZykgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUubWFyZ2luID0gIjAiOwogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLnBhZGRpbmcgPSBwYWRkaW5nVG9Dc3ModW5wYWNrUGFkZGluZyhzaXppbmcucGFkZGluZykpOwogICAgfQoKICAgIGlmIChzaXppbmcuZmlsbCkgewogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgIGlmIChjZWwpIHsKICAgICAgICBjZWwuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgICAgIHZhciBwYWQgPSB1bnBhY2tQYWRkaW5nKHNpemluZy5wYWRkaW5nKTsKICAgICAgICBjZWwuc3R5bGUudG9wID0gcGFkLnRvcCArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLnJpZ2h0ID0gcGFkLnJpZ2h0ICsgInB4IjsKICAgICAgICBjZWwuc3R5bGUuYm90dG9tID0gcGFkLmJvdHRvbSArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLmxlZnQgPSBwYWQubGVmdCArICJweCI7CiAgICAgICAgZWwuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGNlbC5vZmZzZXRXaWR0aDsgfSwKICAgICAgICBnZXRIZWlnaHQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gY2VsLm9mZnNldEhlaWdodDsgfQogICAgICB9OwoKICAgIH0gZWxzZSB7CiAgICAgIGVsLnN0eWxlLndpZHRoID0gcHgoc2l6aW5nLndpZHRoKTsKICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gcHgoc2l6aW5nLmhlaWdodCk7CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGVsLm9mZnNldFdpZHRoOyB9LAogICAgICAgIGdldEhlaWdodDogZnVuY3Rpb24oKSB7IHJldHVybiBlbC5vZmZzZXRIZWlnaHQ7IH0KICAgICAgfTsKICAgIH0KICB9CgogIC8vIERlZmF1bHQgaW1wbGVtZW50YXRpb25zIGZvciBtZXRob2RzCiAgdmFyIGRlZmF1bHRzID0gewogICAgZmluZDogZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgcmV0dXJuIHF1ZXJ5U2VsZWN0b3JBbGwoc2NvcGUsICIuIiArIHRoaXMubmFtZSk7CiAgICB9LAogICAgcmVuZGVyRXJyb3I6IGZ1bmN0aW9uKGVsLCBlcnIpIHsKICAgICAgdmFyICRlbCA9ICQoZWwpOwoKICAgICAgdGhpcy5jbGVhckVycm9yKGVsKTsKCiAgICAgIC8vIEFkZCBhbGwgdGhlc2UgZXJyb3IgY2xhc3NlcywgYXMgU2hpbnkgZG9lcwogICAgICB2YXIgZXJyQ2xhc3MgPSAic2hpbnktb3V0cHV0LWVycm9yIjsKICAgICAgaWYgKGVyci50eXBlICE9PSBudWxsKSB7CiAgICAgICAgLy8gdXNlIHRoZSBjbGFzc2VzIG9mIHRoZSBlcnJvciBjb25kaXRpb24gYXMgQ1NTIGNsYXNzIG5hbWVzCiAgICAgICAgZXJyQ2xhc3MgPSBlcnJDbGFzcyArICIgIiArICQubWFwKGFzQXJyYXkoZXJyLnR5cGUpLCBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICByZXR1cm4gZXJyQ2xhc3MgKyAiLSIgKyB0eXBlOwogICAgICAgIH0pLmpvaW4oIiAiKTsKICAgICAgfQogICAgICBlcnJDbGFzcyA9IGVyckNsYXNzICsgIiBodG1sd2lkZ2V0cy1lcnJvciI7CgogICAgICAvLyBJcyBlbCBpbmxpbmUgb3IgYmxvY2s/IElmIGlubGluZSBvciBpbmxpbmUtYmxvY2ssIGp1c3QgZGlzcGxheTpub25lIGl0CiAgICAgIC8vIGFuZCBhZGQgYW4gaW5saW5lIGVycm9yLgogICAgICB2YXIgZGlzcGxheSA9ICRlbC5jc3MoImRpc3BsYXkiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgZGlzcGxheSk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICAkZWwuaGlkZSgpOwogICAgICAgIGlmIChlcnIubWVzc2FnZSAhPT0gIiIpIHsKICAgICAgICAgIHZhciBlcnJvclNwYW4gPSAkKCI8c3Bhbj4iKS5hZGRDbGFzcyhlcnJDbGFzcyk7CiAgICAgICAgICBlcnJvclNwYW4udGV4dChlcnIubWVzc2FnZSk7CiAgICAgICAgICAkZWwuYWZ0ZXIoZXJyb3JTcGFuKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZGlzcGxheSA9PT0gImJsb2NrIikgewogICAgICAgIC8vIElmIGJsb2NrLCBhZGQgYW4gZXJyb3IganVzdCBhZnRlciB0aGUgZWwsIHNldCB2aXNpYmlsaXR5Om5vbmUgb24gdGhlCiAgICAgICAgLy8gZWwsIGFuZCBwb3NpdGlvbiB0aGUgZXJyb3IgdG8gYmUgb24gdG9wIG9mIHRoZSBlbC4KICAgICAgICAvLyBNYXJrIGl0IHdpdGggYSB1bmlxdWUgSUQgYW5kIENTUyBjbGFzcyBzbyB3ZSBjYW4gcmVtb3ZlIGl0IGxhdGVyLgogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaGlkZGVuIik7CiAgICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSAiIikgewogICAgICAgICAgdmFyIGVycm9yRGl2ID0gJCgiPGRpdj4iKS5hZGRDbGFzcyhlcnJDbGFzcykuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpCiAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgLmNzcygibGVmdCIsIGVsLm9mZnNldExlZnQpCiAgICAgICAgICAgIC8vIHNldHRpbmcgd2lkdGggY2FuIHB1c2ggb3V0IHRoZSBwYWdlIHNpemUsIGZvcmNpbmcgb3RoZXJ3aXNlCiAgICAgICAgICAgIC8vIHVubmVjZXNzYXJ5IHNjcm9sbGJhcnMgdG8gYXBwZWFyIGFuZCBtYWtpbmcgaXQgaW1wb3NzaWJsZSBmb3IKICAgICAgICAgICAgLy8gdGhlIGVsZW1lbnQgdG8gc2hyaW5rOyBzbyB1c2UgbWF4LXdpZHRoIGluc3RlYWQKICAgICAgICAgICAgLmNzcygibWF4V2lkdGgiLCBlbC5vZmZzZXRXaWR0aCkKICAgICAgICAgICAgLmNzcygiaGVpZ2h0IiwgZWwub2Zmc2V0SGVpZ2h0KTsKICAgICAgICAgIGVycm9yRGl2LnRleHQoZXJyLm1lc3NhZ2UpOwogICAgICAgICAgJGVsLmFmdGVyKGVycm9yRGl2KTsKCiAgICAgICAgICAvLyBSZWFsbHkgZHVtYiB3YXkgdG8ga2VlcCB0aGUgc2l6ZS9wb3NpdGlvbiBvZiB0aGUgZXJyb3IgaW4gc3luYyB3aXRoCiAgICAgICAgICAvLyB0aGUgcGFyZW50IGVsZW1lbnQgYXMgdGhlIHdpbmRvdyBpcyByZXNpemVkIG9yIHdoYXRldmVyLgogICAgICAgICAgdmFyIGludElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICghZXJyb3JEaXZbMF0ucGFyZW50RWxlbWVudCkgewogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50SWQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvckRpdgogICAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgICAuY3NzKCJsZWZ0IiwgZWwub2Zmc2V0TGVmdCkKICAgICAgICAgICAgICAuY3NzKCJtYXhXaWR0aCIsIGVsLm9mZnNldFdpZHRoKQogICAgICAgICAgICAgIC5jc3MoImhlaWdodCIsIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNsZWFyRXJyb3I6IGZ1bmN0aW9uKGVsKSB7CiAgICAgIHZhciAkZWwgPSAkKGVsKTsKICAgICAgdmFyIGRpc3BsYXkgPSAkZWwuZGF0YSgicmVzdG9yZS1kaXNwbGF5LW1vZGUiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgbnVsbCk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICBpZiAoZGlzcGxheSkKICAgICAgICAgICRlbC5jc3MoImRpc3BsYXkiLCBkaXNwbGF5KTsKICAgICAgICAkKGVsLm5leHRTaWJsaW5nKS5maWx0ZXIoIi5odG1sd2lkZ2V0cy1lcnJvciIpLnJlbW92ZSgpOwogICAgICB9IGVsc2UgaWYgKGRpc3BsYXkgPT09ICJibG9jayIpewogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaW5oZXJpdCIpOwogICAgICAgICQoZWwubmV4dFNpYmxpbmcpLmZpbHRlcigiLmh0bWx3aWRnZXRzLWVycm9yIikucmVtb3ZlKCk7CiAgICAgIH0KICAgIH0sCiAgICBzaXppbmc6IHt9CiAgfTsKCiAgLy8gQ2FsbGVkIGJ5IHdpZGdldCBiaW5kaW5ncyB0byByZWdpc3RlciBhIG5ldyB0eXBlIG9mIHdpZGdldC4gVGhlIGRlZmluaXRpb24KICAvLyBvYmplY3QgY2FuIGNvbnRhaW4gdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogIC8vIC0gbmFtZSAocmVxdWlyZWQpIC0gQSBzdHJpbmcgaW5kaWNhdGluZyB0aGUgYmluZGluZyBuYW1lLCB3aGljaCB3aWxsIGJlCiAgLy8gICB1c2VkIGJ5IGRlZmF1bHQgYXMgdGhlIENTUyBjbGFzc25hbWUgdG8gbG9vayBmb3IuCiAgLy8gLSBpbml0aWFsaXplIChvcHRpb25hbCkgLSBBIGZ1bmN0aW9uKGVsKSB0aGF0IHdpbGwgYmUgY2FsbGVkIG9uY2UgcGVyCiAgLy8gICB3aWRnZXQgZWxlbWVudDsgaWYgYSB2YWx1ZSBpcyByZXR1cm5lZCwgaXQgd2lsbCBiZSBwYXNzZWQgYXMgdGhlIHRoaXJkCiAgLy8gICB2YWx1ZSB0byByZW5kZXJWYWx1ZS4KICAvLyAtIHJlbmRlclZhbHVlIChyZXF1aXJlZCkgLSBBIGZ1bmN0aW9uKGVsLCBkYXRhLCBpbml0VmFsdWUpIHRoYXQgd2lsbCBiZQogIC8vICAgY2FsbGVkIHdpdGggZGF0YS4gU3RhdGljIGNvbnRleHRzIHdpbGwgY2F1c2UgdGhpcyB0byBiZSBjYWxsZWQgb25jZSBwZXIKICAvLyAgIGVsZW1lbnQ7IFNoaW55IGFwcHMgd2lsbCBjYXVzZSB0aGlzIHRvIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBwZXIKICAvLyAgIGVsZW1lbnQsIGFzIHRoZSBkYXRhIGNoYW5nZXMuCiAgd2luZG93LkhUTUxXaWRnZXRzLndpZGdldCA9IGZ1bmN0aW9uKGRlZmluaXRpb24pIHsKICAgIGlmICghZGVmaW5pdGlvbi5uYW1lKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIG5hbWUiKTsKICAgIH0KICAgIGlmICghZGVmaW5pdGlvbi50eXBlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHR5cGUiKTsKICAgIH0KICAgIC8vIEN1cnJlbnRseSB3ZSBvbmx5IHN1cHBvcnQgb3V0cHV0IHdpZGdldHMKICAgIGlmIChkZWZpbml0aW9uLnR5cGUgIT09ICJvdXRwdXQiKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVW5yZWNvZ25pemVkIHdpZGdldCB0eXBlICciICsgZGVmaW5pdGlvbi50eXBlICsgIiciKTsKICAgIH0KICAgIC8vIFRPRE86IFZlcmlmeSB0aGF0IC5uYW1lIGlzIGEgdmFsaWQgQ1NTIGNsYXNzbmFtZQoKICAgIC8vIFN1cHBvcnQgbmV3LXN0eWxlIGluc3RhbmNlLWJvdW5kIGRlZmluaXRpb25zLiBPbGQtc3R5bGUgY2xhc3MtYm91bmQKICAgIC8vIGRlZmluaXRpb25zIGhhdmUgb25lIHdpZGdldCAib2JqZWN0IiBwZXIgd2lkZ2V0IHBlciB0eXBlL2NsYXNzIG9mCiAgICAvLyB3aWRnZXQ7IHRoZSByZW5kZXJWYWx1ZSBhbmQgcmVzaXplIG1ldGhvZHMgb24gc3VjaCB3aWRnZXQgb2JqZWN0cwogICAgLy8gdGFrZSBlbCBhbmQgaW5zdGFuY2UgYXJndW1lbnRzLCBiZWNhdXNlIHRoZSB3aWRnZXQgb2JqZWN0IGNhbid0CiAgICAvLyBzdG9yZSB0aGVtLiBOZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbnMgaGF2ZSBvbmUgd2lkZ2V0CiAgICAvLyBvYmplY3QgcGVyIHdpZGdldCBpbnN0YW5jZTsgdGhlIGRlZmluaXRpb24gdGhhdCdzIHBhc3NlZCBpbiBkb2Vzbid0CiAgICAvLyBwcm92aWRlIHJlbmRlclZhbHVlIG9yIHJlc2l6ZSBtZXRob2RzIGF0IGFsbCwganVzdCB0aGUgc2luZ2xlIG1ldGhvZAogICAgLy8gICBmYWN0b3J5KGVsLCB3aWR0aCwgaGVpZ2h0KQogICAgLy8gd2hpY2ggcmV0dXJucyBhbiBvYmplY3QgdGhhdCBoYXMgcmVuZGVyVmFsdWUoeCkgYW5kIHJlc2l6ZSh3LCBoKS4KICAgIC8vIFRoaXMgZW5hYmxlcyBhIGZhciBtb3JlIG5hdHVyYWwgcHJvZ3JhbW1pbmcgc3R5bGUgZm9yIHRoZSB3aWRnZXQKICAgIC8vIGF1dGhvciwgd2hvIGNhbiBzdG9yZSBwZXItaW5zdGFuY2Ugc3RhdGUgdXNpbmcgZWl0aGVyIE9PLXN0eWxlCiAgICAvLyBpbnN0YW5jZSBmaWVsZHMgb3IgZnVuY3Rpb25hbC1zdHlsZSBjbG9zdXJlIHZhcmlhYmxlcyAoSSBndWVzcyB0aGlzCiAgICAvLyBpcyBpbiBjb250cmFzdCB0byB3aGF0IGNhbiBvbmx5IGJlIGNhbGxlZCBDLXN0eWxlIHBzZXVkby1PTyB3aGljaCBpcwogICAgLy8gd2hhdCB3ZSByZXF1aXJlZCBiZWZvcmUpLgogICAgaWYgKGRlZmluaXRpb24uZmFjdG9yeSkgewogICAgICBkZWZpbml0aW9uID0gY3JlYXRlTGVnYWN5RGVmaW5pdGlvbkFkYXB0ZXIoZGVmaW5pdGlvbik7CiAgICB9CgogICAgaWYgKCFkZWZpbml0aW9uLnJlbmRlclZhbHVlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHJlbmRlclZhbHVlIGZ1bmN0aW9uIik7CiAgICB9CgogICAgLy8gRm9yIHN0YXRpYyByZW5kZXJpbmcgKG5vbi1TaGlueSksIHVzZSBhIHNpbXBsZSB3aWRnZXQgcmVnaXN0cmF0aW9uCiAgICAvLyBzY2hlbWUuIFdlIGFsc28gdXNlIHRoaXMgc2NoZW1lIGZvciBTaGlueSBhcHBzL2RvY3VtZW50cyB0aGF0IGFsc28KICAgIC8vIGNvbnRhaW4gc3RhdGljIHdpZGdldHMuCiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzIHx8IFtdOwogICAgLy8gTWVyZ2UgZGVmYXVsdHMgaW50byB0aGUgZGVmaW5pdGlvbjsgZG9uJ3QgbXV0YXRlIHRoZSBvcmlnaW5hbCBkZWZpbml0aW9uLgogICAgdmFyIHN0YXRpY0JpbmRpbmcgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKICAgIG92ZXJyaWRlTWV0aG9kKHN0YXRpY0JpbmRpbmcsICJmaW5kIiwgZnVuY3Rpb24oc3VwZXJmdW5jKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbihzY29wZSkgewogICAgICAgIHZhciByZXN1bHRzID0gc3VwZXJmdW5jKHNjb3BlKTsKICAgICAgICAvLyBGaWx0ZXIgb3V0IFNoaW55IG91dHB1dHMsIHdlIG9ubHkgd2FudCB0aGUgc3RhdGljIGtpbmQKICAgICAgICByZXR1cm4gZmlsdGVyQnlDbGFzcyhyZXN1bHRzLCAiaHRtbC13aWRnZXQtb3V0cHV0IiwgZmFsc2UpOwogICAgICB9OwogICAgfSk7CiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cy5wdXNoKHN0YXRpY0JpbmRpbmcpOwoKICAgIGlmIChzaGlueU1vZGUpIHsKICAgICAgLy8gU2hpbnkgaXMgcnVubmluZy4gUmVnaXN0ZXIgdGhlIGRlZmluaXRpb24gd2l0aCBhbiBvdXRwdXQgYmluZGluZy4KICAgICAgLy8gVGhlIGRlZmluaXRpb24gaXRzZWxmIHdpbGwgbm90IGJlIHRoZSBvdXRwdXQgYmluZGluZywgaW5zdGVhZAogICAgICAvLyB3ZSB3aWxsIG1ha2UgYW4gb3V0cHV0IGJpbmRpbmcgb2JqZWN0IHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAgICAvLyBkZWZpbml0aW9uLiBUaGlzIGlzIGJlY2F1c2Ugd2UgZm9vbGlzaGx5IHVzZWQgdGhlIHNhbWUgbWV0aG9kCiAgICAgIC8vIG5hbWUgKHJlbmRlclZhbHVlKSBmb3IgaHRtbHdpZGdldHMgZGVmaW5pdGlvbiBhbmQgU2hpbnkgYmluZGluZ3MKICAgICAgLy8gYnV0IHRoZXkgYWN0dWFsbHkgaGF2ZSBxdWl0ZSBkaWZmZXJlbnQgc2VtYW50aWNzICh0aGUgU2hpbnkKICAgICAgLy8gYmluZGluZ3MgcmVjZWl2ZSBkYXRhIHRoYXQgaW5jbHVkZXMgbG90cyBvZiBtZXRhZGF0YSB0aGF0IGl0CiAgICAgIC8vIHN0cmlwcyBvZmYgYmVmb3JlIGNhbGxpbmcgaHRtbHdpZGdldHMgcmVuZGVyVmFsdWUpLiBXZSBjYW4ndAogICAgICAvLyBqdXN0IGlnbm9yZSB0aGUgZGlmZmVyZW5jZSBiZWNhdXNlIGluIHNvbWUgd2lkZ2V0cyBpdCdzIGhlbHBmdWwKICAgICAgLy8gdG8gY2FsbCB0aGlzLnJlbmRlclZhbHVlKCkgZnJvbSBpbnNpZGUgb2YgcmVzaXplKCksIGFuZCBpZgogICAgICAvLyB3ZSdyZSBub3QgZGVsZWdhdGluZywgdGhlbiB0aGF0IGNhbGwgd2lsbCBnbyB0byB0aGUgU2hpbnkKICAgICAgLy8gdmVyc2lvbiBpbnN0ZWFkIG9mIHRoZSBodG1sd2lkZ2V0cyB2ZXJzaW9uLgoKICAgICAgLy8gTWVyZ2UgZGVmYXVsdHMgd2l0aCBkZWZpbml0aW9uLCB3aXRob3V0IG11dGF0aW5nIGVpdGhlci4KICAgICAgdmFyIGJpbmRpbmdEZWYgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKCiAgICAgIC8vIFRoaXMgb2JqZWN0IHdpbGwgYmUgb3VyIGFjdHVhbCBTaGlueSBiaW5kaW5nLgogICAgICB2YXIgc2hpbnlCaW5kaW5nID0gbmV3IFNoaW55Lk91dHB1dEJpbmRpbmcoKTsKCiAgICAgIC8vIFdpdGggYSBmZXcgZXhjZXB0aW9ucywgd2UnbGwgd2FudCB0byBzaW1wbHkgdXNlIHRoZSBiaW5kaW5nRGVmJ3MKICAgICAgLy8gdmVyc2lvbiBvZiBtZXRob2RzIGlmIHRoZXkgYXJlIGF2YWlsYWJsZSwgb3RoZXJ3aXNlIGZhbGwgYmFjayB0bwogICAgICAvLyBTaGlueSdzIGRlZmF1bHRzLiBOT1RFOiBJZiBTaGlueSdzIG91dHB1dCBiaW5kaW5ncyBnYWluIGFkZGl0aW9uYWwKICAgICAgLy8gbWV0aG9kcyBpbiB0aGUgZnV0dXJlLCBhbmQgd2Ugd2FudCB0aGVtIHRvIGJlIG92ZXJyaWRlYWJsZSBieQogICAgICAvLyBIVE1MV2lkZ2V0IGJpbmRpbmcgZGVmaW5pdGlvbnMsIHRoZW4gd2UnbGwgbmVlZCB0byBhZGQgdGhlbSB0byB0aGlzCiAgICAgIC8vIGxpc3QuCiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImdldElkIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgIm9uVmFsdWVDaGFuZ2UiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAib25WYWx1ZUVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgInJlbmRlckVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImNsZWFyRXJyb3IiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAic2hvd1Byb2dyZXNzIik7CgogICAgICAvLyBUaGUgZmluZCwgcmVuZGVyVmFsdWUsIGFuZCByZXNpemUgYXJlIGhhbmRsZWQgZGlmZmVyZW50bHksIGJlY2F1c2Ugd2UKICAgICAgLy8gd2FudCB0byBhY3R1YWxseSBkZWNvcmF0ZSB0aGUgYmVoYXZpb3Igb2YgdGhlIGJpbmRpbmdEZWYgbWV0aG9kcy4KCiAgICAgIHNoaW55QmluZGluZy5maW5kID0gZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgICB2YXIgcmVzdWx0cyA9IGJpbmRpbmdEZWYuZmluZChzY29wZSk7CgogICAgICAgIC8vIE9ubHkgcmV0dXJuIGVsZW1lbnRzIHRoYXQgYXJlIFNoaW55IG91dHB1dHMsIG5vdCBzdGF0aWMgb25lcwogICAgICAgIHZhciBkeW5hbWljUmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKCIuaHRtbC13aWRnZXQtb3V0cHV0Iik7CgogICAgICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB3aGF0ZXZlciBjYXVzZWQgU2hpbnkgdG8gdGhpbmsgdGhlcmUgbWlnaHQgYmUKICAgICAgICAvLyBuZXcgZHluYW1pYyBvdXRwdXRzLCBhbHNvIGNhdXNlZCB0aGVyZSB0byBiZSBuZXcgc3RhdGljIG91dHB1dHMuCiAgICAgICAgLy8gU2luY2UgdGhlcmUgbWlnaHQgYmUgbG90cyBvZiBkaWZmZXJlbnQgaHRtbHdpZGdldHMgYmluZGluZ3MsIHdlCiAgICAgICAgLy8gc2NoZWR1bGUgZXhlY3V0aW9uIGZvciBsYXRlci0tbm8gbmVlZCB0byBzdGF0aWNSZW5kZXIgbXVsdGlwbGUKICAgICAgICAvLyB0aW1lcy4KICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGggIT09IGR5bmFtaWNSZXN1bHRzLmxlbmd0aCkKICAgICAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyKCk7CgogICAgICAgIHJldHVybiBkeW5hbWljUmVzdWx0czsKICAgICAgfTsKCiAgICAgIC8vIFdyYXAgcmVuZGVyVmFsdWUgdG8gaGFuZGxlIGluaXRpYWxpemF0aW9uLCB3aGljaCB1bmZvcnR1bmF0ZWx5IGlzbid0CiAgICAgIC8vIHN1cHBvcnRlZCBuYXRpdmVseSBieSBTaGlueSBhdCB0aGUgdGltZSBvZiB0aGlzIHdyaXRpbmcuCgogICAgICBzaGlueUJpbmRpbmcucmVuZGVyVmFsdWUgPSBmdW5jdGlvbihlbCwgZGF0YSkgewogICAgICAgIFNoaW55LnJlbmRlckRlcGVuZGVuY2llcyhkYXRhLmRlcHMpOwogICAgICAgIC8vIFJlc29sdmUgc3RyaW5ncyBtYXJrZWQgYXMgamF2YXNjcmlwdCBsaXRlcmFscyB0byBvYmplY3RzCiAgICAgICAgaWYgKCEoZGF0YS5ldmFscyBpbnN0YW5jZW9mIEFycmF5KSkgZGF0YS5ldmFscyA9IFtkYXRhLmV2YWxzXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgZGF0YS5ldmFscyAmJiBpIDwgZGF0YS5ldmFscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyKGRhdGEueCwgZGF0YS5ldmFsc1tpXSk7CiAgICAgICAgfQogICAgICAgIGlmICghYmluZGluZ0RlZi5yZW5kZXJPbk51bGxWYWx1ZSkgewogICAgICAgICAgaWYgKGRhdGEueCA9PT0gbnVsbCkgewogICAgICAgICAgICBlbC5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVsLnN0eWxlLnZpc2liaWxpdHkgPSAiaW5oZXJpdCI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghZWxlbWVudERhdGEoZWwsICJpbml0aWFsaXplZCIpKSB7CiAgICAgICAgICBpbml0U2l6aW5nKGVsKTsKCiAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIiwgdHJ1ZSk7CiAgICAgICAgICBpZiAoYmluZGluZ0RlZi5pbml0aWFsaXplKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBiaW5kaW5nRGVmLmluaXRpYWxpemUoZWwsIGVsLm9mZnNldFdpZHRoLAogICAgICAgICAgICAgIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICAgIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiLCByZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBiaW5kaW5nRGVmLnJlbmRlclZhbHVlKGVsLCBkYXRhLngsIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiKSk7CiAgICAgICAgZXZhbEFuZFJ1bihkYXRhLmpzSG9va3MucmVuZGVyLCBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiksIFtlbCwgZGF0YS54XSk7CiAgICAgIH07CgogICAgICAvLyBPbmx5IG92ZXJyaWRlIHJlc2l6ZSBpZiBiaW5kaW5nRGVmIGltcGxlbWVudHMgaXQKICAgICAgaWYgKGJpbmRpbmdEZWYucmVzaXplKSB7CiAgICAgICAgc2hpbnlCaW5kaW5nLnJlc2l6ZSA9IGZ1bmN0aW9uKGVsLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAvLyBTaGlueSBjYW4gY2FsbCByZXNpemUgYmVmb3JlIGluaXRpYWxpemUvcmVuZGVyVmFsdWUgaGF2ZSBiZWVuCiAgICAgICAgICAvLyBjYWxsZWQsIHdoaWNoIGRvZXNuJ3QgbWFrZSBzZW5zZSBmb3Igd2lkZ2V0cy4KICAgICAgICAgIGlmIChlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIikpIHsKICAgICAgICAgICAgYmluZGluZ0RlZi5yZXNpemUoZWwsIHdpZHRoLCBoZWlnaHQsIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiKSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgU2hpbnkub3V0cHV0QmluZGluZ3MucmVnaXN0ZXIoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLm5hbWUpOwogICAgfQogIH07CgogIHZhciBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBudWxsOwogIGZ1bmN0aW9uIHNjaGVkdWxlU3RhdGljUmVuZGVyKCkgewogICAgaWYgKCFzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQpIHsKICAgICAgc2NoZWR1bGVTdGF0aWNSZW5kZXJUaW1lcklkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBudWxsOwogICAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTsKICAgICAgfSwgMSk7CiAgICB9CiAgfQoKICAvLyBSZW5kZXIgc3RhdGljIHdpZGdldHMgYWZ0ZXIgdGhlIGRvY3VtZW50IGZpbmlzaGVzIGxvYWRpbmcKICAvLyBTdGF0aWNhbGx5IHJlbmRlciBhbGwgZWxlbWVudHMgdGhhdCBhcmUgb2YgdGhpcyB3aWRnZXQncyBjbGFzcwogIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIgPSBmdW5jdGlvbigpIHsKICAgIHZhciBiaW5kaW5ncyA9IHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzIHx8IFtdOwogICAgZm9yRWFjaChiaW5kaW5ncywgZnVuY3Rpb24oYmluZGluZykgewogICAgICB2YXIgbWF0Y2hlcyA9IGJpbmRpbmcuZmluZChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpOwogICAgICBmb3JFYWNoKG1hdGNoZXMsIGZ1bmN0aW9uKGVsKSB7CiAgICAgICAgdmFyIHNpemVPYmogPSBpbml0U2l6aW5nKGVsLCBiaW5kaW5nKTsKCiAgICAgICAgaWYgKGhhc0NsYXNzKGVsLCAiaHRtbC13aWRnZXQtc3RhdGljLWJvdW5kIikpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgZWwuY2xhc3NOYW1lID0gZWwuY2xhc3NOYW1lICsgIiBodG1sLXdpZGdldC1zdGF0aWMtYm91bmQiOwoKICAgICAgICB2YXIgaW5pdFJlc3VsdDsKICAgICAgICBpZiAoYmluZGluZy5pbml0aWFsaXplKSB7CiAgICAgICAgICBpbml0UmVzdWx0ID0gYmluZGluZy5pbml0aWFsaXplKGVsLAogICAgICAgICAgICBzaXplT2JqID8gc2l6ZU9iai5nZXRXaWR0aCgpIDogZWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgIHNpemVPYmogPyBzaXplT2JqLmdldEhlaWdodCgpIDogZWwub2Zmc2V0SGVpZ2h0CiAgICAgICAgICApOwogICAgICAgICAgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIsIGluaXRSZXN1bHQpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGJpbmRpbmcucmVzaXplKSB7CiAgICAgICAgICB2YXIgbGFzdFNpemUgPSB7CiAgICAgICAgICAgIHc6IHNpemVPYmogPyBzaXplT2JqLmdldFdpZHRoKCkgOiBlbC5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgaDogc2l6ZU9iaiA/IHNpemVPYmouZ2V0SGVpZ2h0KCkgOiBlbC5vZmZzZXRIZWlnaHQKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgcmVzaXplSGFuZGxlciA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIHNpemUgPSB7CiAgICAgICAgICAgICAgdzogc2l6ZU9iaiA/IHNpemVPYmouZ2V0V2lkdGgoKSA6IGVsLm9mZnNldFdpZHRoLAogICAgICAgICAgICAgIGg6IHNpemVPYmogPyBzaXplT2JqLmdldEhlaWdodCgpIDogZWwub2Zmc2V0SGVpZ2h0CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChzaXplLncgPT09IDAgJiYgc2l6ZS5oID09PSAwKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgaWYgKHNpemUudyA9PT0gbGFzdFNpemUudyAmJiBzaXplLmggPT09IGxhc3RTaXplLmgpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBsYXN0U2l6ZSA9IHNpemU7CiAgICAgICAgICAgIGJpbmRpbmcucmVzaXplKGVsLCBzaXplLncsIHNpemUuaCwgaW5pdFJlc3VsdCk7CiAgICAgICAgICB9OwoKICAgICAgICAgIG9uKHdpbmRvdywgInJlc2l6ZSIsIHJlc2l6ZUhhbmRsZXIpOwoKICAgICAgICAgIC8vIFRoaXMgaXMgbmVlZGVkIGZvciBjYXNlcyB3aGVyZSB3ZSdyZSBydW5uaW5nIGluIGEgU2hpbnkKICAgICAgICAgIC8vIGFwcCwgYnV0IHRoZSB3aWRnZXQgaXRzZWxmIGlzIG5vdCBhIFNoaW55IG91dHB1dCwgYnV0CiAgICAgICAgICAvLyByYXRoZXIgYSBzaW1wbGUgc3RhdGljIHdpZGdldC4gT25lIGV4YW1wbGUgb2YgdGhpcyBpcwogICAgICAgICAgLy8gYW4gcm1hcmtkb3duIGRvY3VtZW50IHRoYXQgaGFzIHJ1bnRpbWU6c2hpbnkgYW5kIHdpZGdldAogICAgICAgICAgLy8gdGhhdCBpc24ndCBpbiBhIHJlbmRlciBmdW5jdGlvbi4gU2hpbnkgb25seSBrbm93cyB0bwogICAgICAgICAgLy8gY2FsbCByZXNpemUgaGFuZGxlcnMgZm9yIFNoaW55IG91dHB1dHMsIG5vdCBmb3Igc3RhdGljCiAgICAgICAgICAvLyB3aWRnZXRzLCBzbyB3ZSBkbyBpdCBvdXJzZWx2ZXMuCiAgICAgICAgICBpZiAod2luZG93LmpRdWVyeSkgewogICAgICAgICAgICB3aW5kb3cualF1ZXJ5KGRvY3VtZW50KS5vbigKICAgICAgICAgICAgICAic2hvd24uaHRtbHdpZGdldHMgc2hvd24uYnMudGFiLmh0bWx3aWRnZXRzIHNob3duLmJzLmNvbGxhcHNlLmh0bWx3aWRnZXRzIiwKICAgICAgICAgICAgICByZXNpemVIYW5kbGVyCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHdpbmRvdy5qUXVlcnkoZG9jdW1lbnQpLm9uKAogICAgICAgICAgICAgICJoaWRkZW4uaHRtbHdpZGdldHMgaGlkZGVuLmJzLnRhYi5odG1sd2lkZ2V0cyBoaWRkZW4uYnMuY29sbGFwc2UuaHRtbHdpZGdldHMiLAogICAgICAgICAgICAgIHJlc2l6ZUhhbmRsZXIKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBUaGlzIGlzIG5lZWRlZCBmb3IgdGhlIHNwZWNpZmljIGNhc2Ugb2YgaW9zbGlkZXMsIHdoaWNoCiAgICAgICAgICAvLyBmbGlwcyBzbGlkZXMgYmV0d2VlbiBkaXNwbGF5Om5vbmUgYW5kIGRpc3BsYXk6YmxvY2suCiAgICAgICAgICAvLyBJZGVhbGx5IHdlIHdvdWxkIG5vdCBoYXZlIHRvIGhhdmUgaW9zbGlkZS1zcGVjaWZpYyBjb2RlCiAgICAgICAgICAvLyBoZXJlLCBidXQgcmF0aGVyIGhhdmUgaW9zbGlkZXMgcmFpc2UgYSBnZW5lcmljIGV2ZW50LAogICAgICAgICAgLy8gYnV0IHRoZSBybWFya2Rvd24gcGFja2FnZSBqdXN0IHdlbnQgdG8gQ1JBTiBzbyB0aGUKICAgICAgICAgIC8vIHdpbmRvdyB0byBnZXR0aW5nIHRoYXQgZml4ZWQgbWF5IGJlIGxvbmcuCiAgICAgICAgICBpZiAod2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICAgICAgLy8gSXQncyBPSyB0byBsaW1pdCB0aGlzIHRvIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyCiAgICAgICAgICAgIC8vIGJyb3dzZXJzIGJlY2F1c2UgaW9zbGlkZXMgaXRzZWxmIG9ubHkgc3VwcG9ydHMKICAgICAgICAgICAgLy8gc3VjaCBicm93c2Vycy4KICAgICAgICAgICAgb24oZG9jdW1lbnQsICJzbGlkZWVudGVyIiwgcmVzaXplSGFuZGxlcik7CiAgICAgICAgICAgIG9uKGRvY3VtZW50LCAic2xpZGVsZWF2ZSIsIHJlc2l6ZUhhbmRsZXIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHNjcmlwdERhdGEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJzY3JpcHRbZGF0YS1mb3I9JyIgKyBlbC5pZCArICInXVt0eXBlPSdhcHBsaWNhdGlvbi9qc29uJ10iKTsKICAgICAgICBpZiAoc2NyaXB0RGF0YSkgewogICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKHNjcmlwdERhdGEudGV4dENvbnRlbnQgfHwgc2NyaXB0RGF0YS50ZXh0KTsKICAgICAgICAgIC8vIFJlc29sdmUgc3RyaW5ncyBtYXJrZWQgYXMgamF2YXNjcmlwdCBsaXRlcmFscyB0byBvYmplY3RzCiAgICAgICAgICBpZiAoIShkYXRhLmV2YWxzIGluc3RhbmNlb2YgQXJyYXkpKSBkYXRhLmV2YWxzID0gW2RhdGEuZXZhbHNdOwogICAgICAgICAgZm9yICh2YXIgayA9IDA7IGRhdGEuZXZhbHMgJiYgayA8IGRhdGEuZXZhbHMubGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyKGRhdGEueCwgZGF0YS5ldmFsc1trXSk7CiAgICAgICAgICB9CiAgICAgICAgICBiaW5kaW5nLnJlbmRlclZhbHVlKGVsLCBkYXRhLngsIGluaXRSZXN1bHQpOwogICAgICAgICAgZXZhbEFuZFJ1bihkYXRhLmpzSG9va3MucmVuZGVyLCBpbml0UmVzdWx0LCBbZWwsIGRhdGEueF0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKCiAgICBpbnZva2VQb3N0UmVuZGVySGFuZGxlcnMoKTsKICB9CgogIC8vIFdhaXQgdW50aWwgYWZ0ZXIgdGhlIGRvY3VtZW50IGhhcyBsb2FkZWQgdG8gcmVuZGVyIHRoZSB3aWRnZXRzLgogIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgZnVuY3Rpb24oKSB7CiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBhcmd1bWVudHMuY2FsbGVlLCBmYWxzZSk7CiAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTsKICAgIH0sIGZhbHNlKTsKICB9IGVsc2UgaWYgKGRvY3VtZW50LmF0dGFjaEV2ZW50KSB7CiAgICBkb2N1bWVudC5hdHRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIiwgZnVuY3Rpb24oKSB7CiAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiKSB7CiAgICAgICAgZG9jdW1lbnQuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGFyZ3VtZW50cy5jYWxsZWUpOwogICAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTsKICAgICAgfQogICAgfSk7CiAgfQoKCiAgd2luZG93LkhUTUxXaWRnZXRzLmdldEF0dGFjaG1lbnRVcmwgPSBmdW5jdGlvbihkZXBuYW1lLCBrZXkpIHsKICAgIC8vIElmIG5vIGtleSwgZGVmYXVsdCB0byB0aGUgZmlyc3QgaXRlbQogICAgaWYgKHR5cGVvZihrZXkpID09PSAidW5kZWZpbmVkIikKICAgICAga2V5ID0gMTsKCiAgICB2YXIgbGluayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRlcG5hbWUgKyAiLSIgKyBrZXkgKyAiLWF0dGFjaG1lbnQiKTsKICAgIGlmICghbGluaykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkF0dGFjaG1lbnQgIiArIGRlcG5hbWUgKyAiLyIgKyBrZXkgKyAiIG5vdCBmb3VuZCBpbiBkb2N1bWVudCIpOwogICAgfQogICAgcmV0dXJuIGxpbmsuZ2V0QXR0cmlidXRlKCJocmVmIik7CiAgfTsKCiAgd2luZG93LkhUTUxXaWRnZXRzLmRhdGFmcmFtZVRvRDMgPSBmdW5jdGlvbihkZikgewogICAgdmFyIG5hbWVzID0gW107CiAgICB2YXIgbGVuZ3RoOwogICAgZm9yICh2YXIgbmFtZSBpbiBkZikgewogICAgICAgIGlmIChkZi5oYXNPd25Qcm9wZXJ0eShuYW1lKSkKICAgICAgICAgICAgbmFtZXMucHVzaChuYW1lKTsKICAgICAgICBpZiAodHlwZW9mKGRmW25hbWVdKSAhPT0gIm9iamVjdCIgfHwgdHlwZW9mKGRmW25hbWVdLmxlbmd0aCkgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWxsIGZpZWxkcyBtdXN0IGJlIGFycmF5cyIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mKGxlbmd0aCkgIT09ICJ1bmRlZmluZWQiICYmIGxlbmd0aCAhPT0gZGZbbmFtZV0ubGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWxsIGZpZWxkcyBtdXN0IGJlIGFycmF5cyBvZiB0aGUgc2FtZSBsZW5ndGgiKTsKICAgICAgICB9CiAgICAgICAgbGVuZ3RoID0gZGZbbmFtZV0ubGVuZ3RoOwogICAgfQogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciBpdGVtOwogICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgbGVuZ3RoOyByb3crKykgewogICAgICAgIGl0ZW0gPSB7fTsKICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCBuYW1lcy5sZW5ndGg7IGNvbCsrKSB7CiAgICAgICAgICAgIGl0ZW1bbmFtZXNbY29sXV0gPSBkZltuYW1lc1tjb2xdXVtyb3ddOwogICAgICAgIH0KICAgICAgICByZXN1bHRzLnB1c2goaXRlbSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB3aW5kb3cuSFRNTFdpZGdldHMudHJhbnNwb3NlQXJyYXkyRCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICAgIGlmIChhcnJheS5sZW5ndGggPT09IDApIHJldHVybiBhcnJheTsKICAgICAgdmFyIG5ld0FycmF5ID0gYXJyYXlbMF0ubWFwKGZ1bmN0aW9uKGNvbCwgaSkgewogICAgICAgICAgcmV0dXJuIGFycmF5Lm1hcChmdW5jdGlvbihyb3cpIHsKICAgICAgICAgICAgICByZXR1cm4gcm93W2ldCiAgICAgICAgICB9KQogICAgICB9KTsKICAgICAgcmV0dXJuIG5ld0FycmF5OwogIH07CiAgLy8gU3BsaXQgdmFsdWUgYXQgc3BsaXRDaGFyLCBidXQgYWxsb3cgc3BsaXRDaGFyIHRvIGJlIGVzY2FwZWQKICAvLyB1c2luZyBlc2NhcGVDaGFyLiBBbnkgb3RoZXIgY2hhcmFjdGVycyBlc2NhcGVkIGJ5IGVzY2FwZUNoYXIKICAvLyB3aWxsIGJlIGluY2x1ZGVkIGFzIHVzdWFsIChpbmNsdWRpbmcgZXNjYXBlQ2hhciBpdHNlbGYpLgogIGZ1bmN0aW9uIHNwbGl0V2l0aEVzY2FwZSh2YWx1ZSwgc3BsaXRDaGFyLCBlc2NhcGVDaGFyKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgdmFyIGVzY2FwZU1vZGUgPSBmYWxzZTsKICAgIHZhciBjdXJyZW50UmVzdWx0ID0gIiI7CiAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCB2YWx1ZS5sZW5ndGg7IHBvcysrKSB7CiAgICAgIGlmICghZXNjYXBlTW9kZSkgewogICAgICAgIGlmICh2YWx1ZVtwb3NdID09PSBzcGxpdENoYXIpIHsKICAgICAgICAgIHJlc3VsdHMucHVzaChjdXJyZW50UmVzdWx0KTsKICAgICAgICAgIGN1cnJlbnRSZXN1bHQgPSAiIjsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlW3Bvc10gPT09IGVzY2FwZUNoYXIpIHsKICAgICAgICAgIGVzY2FwZU1vZGUgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdXJyZW50UmVzdWx0ICs9IHZhbHVlW3Bvc107CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGN1cnJlbnRSZXN1bHQgKz0gdmFsdWVbcG9zXTsKICAgICAgICBlc2NhcGVNb2RlID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGlmIChjdXJyZW50UmVzdWx0ICE9PSAiIikgewogICAgICByZXN1bHRzLnB1c2goY3VycmVudFJlc3VsdCk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9CiAgLy8gRnVuY3Rpb24gYXV0aG9yZWQgYnkgWWlodWkvSkogQWxsYWlyZQogIHdpbmRvdy5IVE1MV2lkZ2V0cy5ldmFsdWF0ZVN0cmluZ01lbWJlciA9IGZ1bmN0aW9uKG8sIG1lbWJlcikgewogICAgdmFyIHBhcnRzID0gc3BsaXRXaXRoRXNjYXBlKG1lbWJlciwgJy4nLCAnXFwnKTsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gcGFydHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIHZhciBwYXJ0ID0gcGFydHNbaV07CiAgICAgIC8vIHBhcnQgbWF5IGJlIGEgY2hhcmFjdGVyIG9yICdudW1lcmljJyBtZW1iZXIgbmFtZQogICAgICBpZiAobyAhPT0gbnVsbCAmJiB0eXBlb2YgbyA9PT0gIm9iamVjdCIgJiYgcGFydCBpbiBvKSB7CiAgICAgICAgaWYgKGkgPT0gKGwgLSAxKSkgeyAvLyBpZiB3ZSBhcmUgYXQgdGhlIGVuZCBvZiB0aGUgbGluZSB0aGVuIGV2YWx1bGF0ZQogICAgICAgICAgaWYgKHR5cGVvZiBvW3BhcnRdID09PSAic3RyaW5nIikKICAgICAgICAgICAgb1twYXJ0XSA9IGV2YWwoIigiICsgb1twYXJ0XSArICIpIik7CiAgICAgICAgfSBlbHNlIHsgLy8gb3RoZXJ3aXNlIGNvbnRpbnVlIHRvIG5leHQgZW1iZWRkZWQgb2JqZWN0CiAgICAgICAgICBvID0gb1twYXJ0XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvLyBSZXRyaWV2ZSB0aGUgSFRNTFdpZGdldCBpbnN0YW5jZSAoaS5lLiB0aGUgcmV0dXJuIHZhbHVlIG9mIGFuCiAgLy8gSFRNTFdpZGdldCBiaW5kaW5nJ3MgaW5pdGlhbGl6ZSgpIG9yIGZhY3RvcnkoKSBmdW5jdGlvbikKICAvLyBhc3NvY2lhdGVkIHdpdGggYW4gZWxlbWVudCwgb3IgbnVsbCBpZiBub25lLgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKGVsKSB7CiAgICByZXR1cm4gZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpOwogIH07CgogIC8vIEZpbmRzIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBzY29wZSB0aGF0IG1hdGNoZXMgdGhlIHNlbGVjdG9yLAogIC8vIGFuZCByZXR1cm5zIHRoZSBIVE1MV2lkZ2V0IGluc3RhbmNlIChpLmUuIHRoZSByZXR1cm4gdmFsdWUgb2YKICAvLyBhbiBIVE1MV2lkZ2V0IGJpbmRpbmcncyBpbml0aWFsaXplKCkgb3IgZmFjdG9yeSgpIGZ1bmN0aW9uKQogIC8vIGFzc29jaWF0ZWQgd2l0aCB0aGF0IGVsZW1lbnQsIGlmIGFueS4gSWYgbm8gZWxlbWVudCBtYXRjaGVzIHRoZQogIC8vIHNlbGVjdG9yLCBvciB0aGUgZmlyc3QgbWF0Y2hpbmcgZWxlbWVudCBoYXMgbm8gSFRNTFdpZGdldAogIC8vIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCBpdCwgdGhlbiBudWxsIGlzIHJldHVybmVkLgogIC8vCiAgLy8gVGhlIHNjb3BlIGFyZ3VtZW50IGlzIG9wdGlvbmFsLCBhbmQgZGVmYXVsdHMgdG8gd2luZG93LmRvY3VtZW50LgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5maW5kID0gZnVuY3Rpb24oc2NvcGUsIHNlbGVjdG9yKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7CiAgICAgIHNlbGVjdG9yID0gc2NvcGU7CiAgICAgIHNjb3BlID0gZG9jdW1lbnQ7CiAgICB9CgogICAgdmFyIGVsID0gc2NvcGUucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7CiAgICBpZiAoZWwgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gd2luZG93LkhUTUxXaWRnZXRzLmdldEluc3RhbmNlKGVsKTsKICAgIH0KICB9OwoKICAvLyBGaW5kcyBhbGwgZWxlbWVudHMgaW4gdGhlIHNjb3BlIHRoYXQgbWF0Y2ggdGhlIHNlbGVjdG9yLCBhbmQKICAvLyByZXR1cm5zIHRoZSBIVE1MV2lkZ2V0IGluc3RhbmNlcyAoaS5lLiB0aGUgcmV0dXJuIHZhbHVlcyBvZgogIC8vIGFuIEhUTUxXaWRnZXQgYmluZGluZydzIGluaXRpYWxpemUoKSBvciBmYWN0b3J5KCkgZnVuY3Rpb24pCiAgLy8gYXNzb2NpYXRlZCB3aXRoIHRoZSBlbGVtZW50cywgaW4gYW4gYXJyYXkuIElmIGVsZW1lbnRzIHRoYXQKICAvLyBtYXRjaCB0aGUgc2VsZWN0b3IgZG9uJ3QgaGF2ZSBhbiBhc3NvY2lhdGVkIEhUTUxXaWRnZXQKICAvLyBpbnN0YW5jZSwgdGhlIHJldHVybmVkIGFycmF5IHdpbGwgY29udGFpbiBudWxscy4KICAvLwogIC8vIFRoZSBzY29wZSBhcmd1bWVudCBpcyBvcHRpb25hbCwgYW5kIGRlZmF1bHRzIHRvIHdpbmRvdy5kb2N1bWVudC4KICB3aW5kb3cuSFRNTFdpZGdldHMuZmluZEFsbCA9IGZ1bmN0aW9uKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkgewogICAgICBzZWxlY3RvciA9IHNjb3BlOwogICAgICBzY29wZSA9IGRvY3VtZW50OwogICAgfQoKICAgIHZhciBub2RlcyA9IHNjb3BlLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgcmVzdWx0cy5wdXNoKHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRJbnN0YW5jZShub2Rlc1tpXSkpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgdmFyIHBvc3RSZW5kZXJIYW5kbGVycyA9IFtdOwogIGZ1bmN0aW9uIGludm9rZVBvc3RSZW5kZXJIYW5kbGVycygpIHsKICAgIHdoaWxlIChwb3N0UmVuZGVySGFuZGxlcnMubGVuZ3RoKSB7CiAgICAgIHZhciBoYW5kbGVyID0gcG9zdFJlbmRlckhhbmRsZXJzLnNoaWZ0KCk7CiAgICAgIGlmIChoYW5kbGVyKSB7CiAgICAgICAgaGFuZGxlcigpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZWdpc3RlciB0aGUgZ2l2ZW4gY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgaW52b2tlZCBhZnRlciB0aGUKICAvLyBuZXh0IHRpbWUgc3RhdGljIHdpZGdldHMgYXJlIHJlbmRlcmVkLgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5hZGRQb3N0UmVuZGVySGFuZGxlciA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICBwb3N0UmVuZGVySGFuZGxlcnMucHVzaChjYWxsYmFjayk7CiAgfTsKCiAgLy8gVGFrZXMgYSBuZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbiwgYW5kIHJldHVybnMgYW4KICAvLyBvbGQtc3R5bGUgY2xhc3MtYm91bmQgZGVmaW5pdGlvbi4gVGhpcyBzYXZlcyB1cyBmcm9tIGhhdmluZwogIC8vIHRvIHJld3JpdGUgYWxsIHRoZSBsb2dpYyBpbiB0aGlzIGZpbGUgdG8gYWNjb21vZGF0ZSBib3RoCiAgLy8gdHlwZXMgb2YgZGVmaW5pdGlvbnMuCiAgZnVuY3Rpb24gY3JlYXRlTGVnYWN5RGVmaW5pdGlvbkFkYXB0ZXIoZGVmbikgewogICAgdmFyIHJlc3VsdCA9IHsKICAgICAgbmFtZTogZGVmbi5uYW1lLAogICAgICB0eXBlOiBkZWZuLnR5cGUsCiAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGVsLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgcmV0dXJuIGRlZm4uZmFjdG9yeShlbCwgd2lkdGgsIGhlaWdodCk7CiAgICAgIH0sCiAgICAgIHJlbmRlclZhbHVlOiBmdW5jdGlvbihlbCwgeCwgaW5zdGFuY2UpIHsKICAgICAgICByZXR1cm4gaW5zdGFuY2UucmVuZGVyVmFsdWUoeCk7CiAgICAgIH0sCiAgICAgIHJlc2l6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQsIGluc3RhbmNlKSB7CiAgICAgICAgcmV0dXJuIGluc3RhbmNlLnJlc2l6ZSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgfQogICAgfTsKCiAgICBpZiAoZGVmbi5maW5kKQogICAgICByZXN1bHQuZmluZCA9IGRlZm4uZmluZDsKICAgIGlmIChkZWZuLnJlbmRlckVycm9yKQogICAgICByZXN1bHQucmVuZGVyRXJyb3IgPSBkZWZuLnJlbmRlckVycm9yOwogICAgaWYgKGRlZm4uY2xlYXJFcnJvcikKICAgICAgcmVzdWx0LmNsZWFyRXJyb3IgPSBkZWZuLmNsZWFyRXJyb3I7CgogICAgcmV0dXJuIHJlc3VsdDsKICB9Cn0pKCk7Cgo="></script>
<script src="data:application/x-javascript;base64,SFRNTFdpZGdldHMud2lkZ2V0KHsNCg0KICBuYW1lOiAicGl2b3R0YWJsZXIiLA0KDQogIHR5cGU6ICJvdXRwdXQiLA0KDQogIGZhY3Rvcnk6IGZ1bmN0aW9uKGVsLCB3aWR0aCwgaGVpZ2h0KSB7DQoNCiAgICB2YXIgcGl2b3RFbGVtZW50ID0gZWw7DQogICAgdmFyIGluaXRpYWxpc2VkID0gZmFsc2U7DQoNCiAgICByZXR1cm4gew0KICAgICAgcmVuZGVyVmFsdWU6IGZ1bmN0aW9uKHdpZGdldERhdGEpIHsNCg0KICAgICAgICBpZighaW5pdGlhbGlzZWQpIHsNCiAgICAgICAgICBpZih3aWRnZXREYXRhLnRhYmxlQ3NzICE9PSBudWxsKSB7DQogICAgICAgICAgICBkb2NIZWFkID0gZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdOw0KICAgICAgICAgICAgdmFyIHN0eWxlcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7DQogICAgICAgICAgICBzdHlsZXMuaW5uZXJIVE1MID0gd2lkZ2V0RGF0YS50YWJsZUNzczsNCiAgICAgICAgICAgIGRvY0hlYWQuYXBwZW5kQ2hpbGQoc3R5bGVzKTsNCiAgICAgICAgICB9DQogICAgICAgICAgaW5pdGlhbGlzZWQgPSB0cnVlOw0KICAgICAgICB9DQogICAgICAgIHBpdm90RWxlbWVudC5pbm5lckhUTUwgPSB3aWRnZXREYXRhLnRhYmxlSHRtbDsNCiAgICAgIH0sDQoNCiAgICAgIHJlc2l6ZTogZnVuY3Rpb24od2lkdGgsIGhlaWdodCkgew0KICAgICAgfSwNCg0KICAgIH07DQogIH0NCn0pOw0K"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore"><ol start="6" style="list-style-type: decimal">
<li>Styling</li>
</ol></h1>
<h4 class="author"><em>Chris Bailiss</em></h4>
<h4 class="date"><em>2018-10-17</em></h4>



<div id="in-this-vignette" class="section level2">
<h2>In This Vignette</h2>
<ul>
<li>Styles and Themes</li>
<li>Styles and CSS</li>
<li>XL Styles</li>
<li>Included Themes</li>
<li>Simple Themes</li>
<li>Creating a New Theme</li>
<li>Changing the appearance of individual cells</li>
<li>Styling Reference</li>
<li>Further Reading</li>
</ul>
</div>
<div id="styles-and-themes" class="section level2">
<h2>Styles and Themes</h2>
<p><code>pivottabler</code> can render pivot tables in HTML and Latex. The focus of this vignette is styling when rendering to HTML.</p>
<p><code>pivottabler</code> offers only limited styling options when rendering to Latex. Please see the <a href="v05-latexoutput.html">Latex Output</a> vignette for details.</p>
<p>When rendered to HTML, the appearance of <code>pivottabler</code> pivot tables can be changed using styles and themes:</p>
<ul>
<li>A style defines the appearance of a cell in the pivot table.
<ul>
<li>A cell here is a general term that covers row/column headings, values in the body of the pivot table and totals.</li>
</ul></li>
<li>A style has a name and a set of style settings.</li>
<li>Each pivot table has a collection of styles.</li>
<li>For each cell in the pivot table, a style name can be set.</li>
<li>A theme is a collection of styles that can easily be applied to a pivot table.</li>
</ul>
<p>The <code>pivottabler</code> package is supplied with some basic themes. Additional themes can be defined.</p>
</div>
<div id="styles-and-css" class="section level2">
<h2>Styles and CSS</h2>
<p>A style is a collection of name-value pairs. The name-value pairs used to specify styles are simply Cascading Style Sheet properties and values. A full introduction and reference for CSS can be found on the <a href="https://www.w3schools.com/css/default.asp">w3schools</a> website.</p>
<p>An example of defining a <code>pivottabler</code> style is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pivotStyles<span class="op">$</span><span class="kw">addStyle</span>(<span class="dt">styleName=</span><span class="st">&quot;ColumnHeader&quot;</span>, <span class="kw">list</span>(
    <span class="st">&quot;font-family&quot;</span>=<span class="st">&quot;arial&quot;</span>,
    <span class="st">&quot;font-size&quot;</span>=<span class="st">&quot;0.75em&quot;</span>,
    <span class="dt">padding=</span><span class="st">&quot;2px&quot;</span>,
    <span class="dt">border=</span><span class="st">&quot;1px solid blue&quot;</span>,
    <span class="st">&quot;vertical-align&quot;</span>=<span class="st">&quot;middle&quot;</span>,
    <span class="st">&quot;text-align&quot;</span>=<span class="st">&quot;center&quot;</span>,
    <span class="st">&quot;font-weight&quot;</span>=<span class="st">&quot;bold&quot;</span>,
    <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>,
    <span class="st">&quot;background-color&quot;</span>=<span class="st">&quot;#FFFFFF&quot;</span>,
    <span class="st">&quot;xl-wrap-text&quot;</span>=<span class="st">&quot;wrap&quot;</span>
  ))</code></pre></div>
<p>When viewing pivot tables in an IDE such as R Studio, then typically only one pivot table is viewed at a time.</p>
<p>If multiple pivot tables are being output together (e.g. into a single HTML page) then specifying a <code>styleNamePrefix</code> in the <code>pt$renderPivot()</code> call is needed. The CSS declarations generated by the <code>pivottabler</code> package for each pivot table will then not overlap with each other. This can be seen in all of the examples in this vignette.</p>
</div>
<div id="xl-styles" class="section level2">
<h2>XL Styles</h2>
<p>The <code>pivottabler</code> package also supports outputting to Excel files. The Excel output can use CSS styling and/or Excel specific styling. The Excel specific styles are defined alongside the CSS styles and start with “xl-”, e.g. see the example above. The Excel specific styles are ignored by the HTML output. For more details about the Excel export, see the <a href="v12-excelexport.html">Excel Export</a> vignette.</p>
</div>
<div id="included-themes" class="section level2">
<h2>Included Themes</h2>
<p>The <code>pivottabler</code> package includes three basic themes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># basic theme</span>
<span class="kw">library</span>(pivottabler)
pt &lt;-<span class="st"> </span>PivotTable<span class="op">$</span><span class="kw">new</span>()
pt<span class="op">$</span><span class="kw">addData</span>(bhmtrains)
pt<span class="op">$</span><span class="kw">addColumnDataGroups</span>(<span class="st">&quot;TrainCategory&quot;</span>)
pt<span class="op">$</span><span class="kw">addRowDataGroups</span>(<span class="st">&quot;TOC&quot;</span>)
pt<span class="op">$</span><span class="kw">defineCalculation</span>(<span class="dt">calculationName=</span><span class="st">&quot;TotalTrains&quot;</span>, <span class="dt">summariseExpression=</span><span class="st">&quot;n()&quot;</span>)
pt<span class="op">$</span>theme &lt;-<span class="st"> &quot;default&quot;</span>  <span class="co"># this theme is already the default, so this line isn't really needed</span>
pt<span class="op">$</span><span class="kw">renderPivot</span>(<span class="dt">styleNamePrefix=</span><span class="st">&quot;t0&quot;</span>)</code></pre></div>
<div id="htmlwidget-c06ca6701dadaa9110d7" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-c06ca6701dadaa9110d7">{"x":{"tableCss":".t0Table {border-collapse: collapse; }\r\n.t0ColumnHeader {font-family: Arial; font-size: 0.75em; padding: 2px; border: 1px solid lightgray; vertical-align: middle; text-align: center; font-weight: bold; background-color: #F2F2F2; }\r\n.t0RowHeader {font-family: Arial; font-size: 0.75em; padding: 2px 8px 2px 2px; border: 1px solid lightgray; vertical-align: middle; text-align: left; font-weight: bold; background-color: #F2F2F2; }\r\n.t0Cell {font-family: Arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid lightgray; vertical-align: middle; text-align: right; }\r\n","tableHtml":"<table class=\"t0Table\">\n  <tr>\n    <th class=\"t0RowHeader\" rowspan=\"1\" colspan=\"1\">&nbsp;<\/th>\n    <th class=\"t0ColumnHeader\" colspan=\"1\">Express Passenger<\/th>\n    <th class=\"t0ColumnHeader\" colspan=\"1\">Ordinary Passenger<\/th>\n    <th class=\"t0ColumnHeader\" colspan=\"1\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"t0RowHeader\" rowspan=\"1\">Arriva Trains Wales<\/th>\n    <td class=\"t0Cell\">3079<\/td>\n    <td class=\"t0Cell\">830<\/td>\n    <td class=\"t0Cell\">3909<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t0RowHeader\" rowspan=\"1\">CrossCountry<\/th>\n    <td class=\"t0Cell\">22865<\/td>\n    <td class=\"t0Cell\">63<\/td>\n    <td class=\"t0Cell\">22928<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t0RowHeader\" rowspan=\"1\">London Midland<\/th>\n    <td class=\"t0Cell\">14487<\/td>\n    <td class=\"t0Cell\">33792<\/td>\n    <td class=\"t0Cell\">48279<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t0RowHeader\" rowspan=\"1\">Virgin Trains<\/th>\n    <td class=\"t0Cell\">8594<\/td>\n    <td class=\"t0Cell\"><\/td>\n    <td class=\"t0Cell\">8594<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t0RowHeader\" rowspan=\"1\">Total<\/th>\n    <td class=\"t0Cell\">49025<\/td>\n    <td class=\"t0Cell\">34685<\/td>\n    <td class=\"t0Cell\">83710<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># compact theme</span>
<span class="kw">library</span>(pivottabler)
pt &lt;-<span class="st"> </span>PivotTable<span class="op">$</span><span class="kw">new</span>()
pt<span class="op">$</span><span class="kw">addData</span>(bhmtrains)
pt<span class="op">$</span><span class="kw">addColumnDataGroups</span>(<span class="st">&quot;TrainCategory&quot;</span>)
pt<span class="op">$</span><span class="kw">addRowDataGroups</span>(<span class="st">&quot;TOC&quot;</span>)
pt<span class="op">$</span><span class="kw">defineCalculation</span>(<span class="dt">calculationName=</span><span class="st">&quot;TotalTrains&quot;</span>, <span class="dt">summariseExpression=</span><span class="st">&quot;n()&quot;</span>)
pt<span class="op">$</span>theme &lt;-<span class="st"> &quot;compact&quot;</span>
pt<span class="op">$</span><span class="kw">renderPivot</span>(<span class="dt">styleNamePrefix=</span><span class="st">&quot;t1&quot;</span>)</code></pre></div>
<div id="htmlwidget-5a4f3c613936736d9005" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-5a4f3c613936736d9005">{"x":{"tableCss":".t1Table {border-collapse: collapse; }\r\n.t1ColumnHeader {font-family: Arial; font-size: 0.625em; padding: 2px; border: 1px solid lightgray; vertical-align: middle; text-align: center; font-weight: bold; background-color: #F2F2F2; }\r\n.t1RowHeader {font-family: Arial; font-size: 0.625em; padding: 2px 4px 2px 2px; border: 1px solid lightgray; vertical-align: middle; text-align: left; font-weight: bold; background-color: #F2F2F2; }\r\n.t1Cell {font-family: Arial; font-size: 0.625em; padding: 2px 2px 2px 6px; border: 1px solid lightgray; vertical-align: middle; text-align: right; }\r\n","tableHtml":"<table class=\"t1Table\">\n  <tr>\n    <th class=\"t1RowHeader\" rowspan=\"1\" colspan=\"1\">&nbsp;<\/th>\n    <th class=\"t1ColumnHeader\" colspan=\"1\">Express Passenger<\/th>\n    <th class=\"t1ColumnHeader\" colspan=\"1\">Ordinary Passenger<\/th>\n    <th class=\"t1ColumnHeader\" colspan=\"1\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"t1RowHeader\" rowspan=\"1\">Arriva Trains Wales<\/th>\n    <td class=\"t1Cell\">3079<\/td>\n    <td class=\"t1Cell\">830<\/td>\n    <td class=\"t1Cell\">3909<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t1RowHeader\" rowspan=\"1\">CrossCountry<\/th>\n    <td class=\"t1Cell\">22865<\/td>\n    <td class=\"t1Cell\">63<\/td>\n    <td class=\"t1Cell\">22928<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t1RowHeader\" rowspan=\"1\">London Midland<\/th>\n    <td class=\"t1Cell\">14487<\/td>\n    <td class=\"t1Cell\">33792<\/td>\n    <td class=\"t1Cell\">48279<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t1RowHeader\" rowspan=\"1\">Virgin Trains<\/th>\n    <td class=\"t1Cell\">8594<\/td>\n    <td class=\"t1Cell\"><\/td>\n    <td class=\"t1Cell\">8594<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t1RowHeader\" rowspan=\"1\">Total<\/th>\n    <td class=\"t1Cell\">49025<\/td>\n    <td class=\"t1Cell\">34685<\/td>\n    <td class=\"t1Cell\">83710<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># large plain theme</span>
<span class="kw">library</span>(pivottabler)
pt &lt;-<span class="st"> </span>PivotTable<span class="op">$</span><span class="kw">new</span>()
pt<span class="op">$</span><span class="kw">addData</span>(bhmtrains)
pt<span class="op">$</span><span class="kw">addColumnDataGroups</span>(<span class="st">&quot;TrainCategory&quot;</span>)
pt<span class="op">$</span><span class="kw">addRowDataGroups</span>(<span class="st">&quot;TOC&quot;</span>)
pt<span class="op">$</span><span class="kw">defineCalculation</span>(<span class="dt">calculationName=</span><span class="st">&quot;TotalTrains&quot;</span>, <span class="dt">summariseExpression=</span><span class="st">&quot;n()&quot;</span>)
pt<span class="op">$</span>theme &lt;-<span class="st"> &quot;largeplain&quot;</span>
pt<span class="op">$</span><span class="kw">renderPivot</span>(<span class="dt">styleNamePrefix=</span><span class="st">&quot;t2&quot;</span>)</code></pre></div>
<div id="htmlwidget-7ae67a8ac1ce2dc3bbd1" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-7ae67a8ac1ce2dc3bbd1">{"x":{"tableCss":".t2Table {border-collapse: collapse; }\r\n.t2ColumnHeader {font-family: Arial; font-size: 0.875em; padding: 4px; min-width: 100px; border: 1px solid lightgray; vertical-align: middle; text-align: center; font-weight: bold; }\r\n.t2RowHeader {font-family: Arial; font-size: 0.875em; padding: 4px; min-width: 100px; border: 1px solid lightgray; vertical-align: middle; text-align: left; font-weight: bold; }\r\n.t2Cell {font-family: Arial; font-size: 0.875em; padding: 4px; min-width: 100px; border: 1px solid lightgray; vertical-align: middle; text-align: right; }\r\n","tableHtml":"<table class=\"t2Table\">\n  <tr>\n    <th class=\"t2RowHeader\" rowspan=\"1\" colspan=\"1\">&nbsp;<\/th>\n    <th class=\"t2ColumnHeader\" colspan=\"1\">Express Passenger<\/th>\n    <th class=\"t2ColumnHeader\" colspan=\"1\">Ordinary Passenger<\/th>\n    <th class=\"t2ColumnHeader\" colspan=\"1\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"t2RowHeader\" rowspan=\"1\">Arriva Trains Wales<\/th>\n    <td class=\"t2Cell\">3079<\/td>\n    <td class=\"t2Cell\">830<\/td>\n    <td class=\"t2Cell\">3909<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t2RowHeader\" rowspan=\"1\">CrossCountry<\/th>\n    <td class=\"t2Cell\">22865<\/td>\n    <td class=\"t2Cell\">63<\/td>\n    <td class=\"t2Cell\">22928<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t2RowHeader\" rowspan=\"1\">London Midland<\/th>\n    <td class=\"t2Cell\">14487<\/td>\n    <td class=\"t2Cell\">33792<\/td>\n    <td class=\"t2Cell\">48279<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t2RowHeader\" rowspan=\"1\">Virgin Trains<\/th>\n    <td class=\"t2Cell\">8594<\/td>\n    <td class=\"t2Cell\"><\/td>\n    <td class=\"t2Cell\">8594<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t2RowHeader\" rowspan=\"1\">Total<\/th>\n    <td class=\"t2Cell\">49025<\/td>\n    <td class=\"t2Cell\">34685<\/td>\n    <td class=\"t2Cell\">83710<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script>
</div>
<div id="simple-themes" class="section level2">
<h2>Simple Themes</h2>
<p>The <code>pivottabler</code> package includes the <code>getSimpleColoredTheme()</code> function that helps define basic new themes quickly. Several examples of using this function are shown below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define the colours</span>
blue1Colors &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">headerBackgroundColor =</span> <span class="st">&quot;rgb(68, 114, 196)&quot;</span>,
  <span class="dt">headerColor =</span> <span class="st">&quot;rgb(255, 255, 255)&quot;</span>,
  <span class="dt">cellBackgroundColor =</span> <span class="st">&quot;rgb(255, 255, 255)&quot;</span>,
  <span class="dt">cellColor =</span> <span class="st">&quot;rgb(0, 0, 0)&quot;</span>,
  <span class="dt">totalBackgroundColor =</span> <span class="st">&quot;rgb(186, 202, 233)&quot;</span>,
  <span class="dt">totalColor =</span> <span class="st">&quot;rgb(0, 0, 0)&quot;</span>,
  <span class="dt">borderColor =</span> <span class="st">&quot;rgb(48, 84, 150)&quot;</span>
)
<span class="co"># create the pivot table</span>
<span class="kw">library</span>(pivottabler)
pt &lt;-<span class="st"> </span>PivotTable<span class="op">$</span><span class="kw">new</span>()
pt<span class="op">$</span><span class="kw">addData</span>(bhmtrains)
pt<span class="op">$</span><span class="kw">addColumnDataGroups</span>(<span class="st">&quot;TrainCategory&quot;</span>)
pt<span class="op">$</span><span class="kw">addRowDataGroups</span>(<span class="st">&quot;TOC&quot;</span>)
pt<span class="op">$</span><span class="kw">defineCalculation</span>(<span class="dt">calculationName=</span><span class="st">&quot;TotalTrains&quot;</span>, <span class="dt">summariseExpression=</span><span class="st">&quot;n()&quot;</span>)
<span class="co"># define the theme</span>
theme &lt;-<span class="st"> </span><span class="kw">getSimpleColoredTheme</span>(<span class="dt">parentPivot=</span>pt, <span class="dt">colors=</span>blue1Colors, <span class="dt">fontName=</span><span class="st">&quot;Verdana, Arial&quot;</span>)
pt<span class="op">$</span>theme &lt;-<span class="st"> </span>theme
pt<span class="op">$</span><span class="kw">renderPivot</span>(<span class="dt">styleNamePrefix=</span><span class="st">&quot;t3&quot;</span>)</code></pre></div>
<div id="htmlwidget-a41eb938766e32ddb4b4" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-a41eb938766e32ddb4b4">{"x":{"tableCss":".t3Table {border-collapse: collapse; border: 2px solid rgb(48, 84, 150); }\r\n.t3ColumnHeader {font-family: Verdana, Arial; font-size: 0.75em; padding: 2px; border: 1px solid rgb(48, 84, 150); vertical-align: middle; text-align: center; font-weight: bold; color: rgb(255, 255, 255); background-color: rgb(68, 114, 196); }\r\n.t3RowHeader {font-family: Verdana, Arial; font-size: 0.75em; padding: 2px 8px 2px 2px; border: 1px solid rgb(48, 84, 150); vertical-align: middle; text-align: left; font-weight: bold; color: rgb(255, 255, 255); background-color: rgb(68, 114, 196); }\r\n.t3Cell {font-family: Verdana, Arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid rgb(48, 84, 150); vertical-align: middle; text-align: right; color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); }\r\n.t3Total {font-family: Verdana, Arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid rgb(48, 84, 150); vertical-align: middle; text-align: right; color: rgb(0, 0, 0); background-color: rgb(186, 202, 233); }\r\n","tableHtml":"<table class=\"t3Table\">\n  <tr>\n    <th class=\"t3ColumnHeader\" rowspan=\"1\" colspan=\"1\">&nbsp;<\/th>\n    <th class=\"t3ColumnHeader\" colspan=\"1\">Express Passenger<\/th>\n    <th class=\"t3ColumnHeader\" colspan=\"1\">Ordinary Passenger<\/th>\n    <th class=\"t3ColumnHeader\" colspan=\"1\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"t3RowHeader\" rowspan=\"1\">Arriva Trains Wales<\/th>\n    <td class=\"t3Cell\">3079<\/td>\n    <td class=\"t3Cell\">830<\/td>\n    <td class=\"t3Total\">3909<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t3RowHeader\" rowspan=\"1\">CrossCountry<\/th>\n    <td class=\"t3Cell\">22865<\/td>\n    <td class=\"t3Cell\">63<\/td>\n    <td class=\"t3Total\">22928<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t3RowHeader\" rowspan=\"1\">London Midland<\/th>\n    <td class=\"t3Cell\">14487<\/td>\n    <td class=\"t3Cell\">33792<\/td>\n    <td class=\"t3Total\">48279<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t3RowHeader\" rowspan=\"1\">Virgin Trains<\/th>\n    <td class=\"t3Cell\">8594<\/td>\n    <td class=\"t3Cell\"><\/td>\n    <td class=\"t3Total\">8594<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t3RowHeader\" rowspan=\"1\">Total<\/th>\n    <td class=\"t3Total\">49025<\/td>\n    <td class=\"t3Total\">34685<\/td>\n    <td class=\"t3Total\">83710<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define the colours</span>
grayColors &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">headerBackgroundColor =</span> <span class="st">&quot;rgb(128, 128, 128)&quot;</span>,
  <span class="dt">headerColor =</span> <span class="st">&quot;rgb(255, 255, 255)&quot;</span>,
  <span class="dt">cellBackgroundColor =</span> <span class="st">&quot;rgb(255, 255, 255)&quot;</span>,
  <span class="dt">cellColor =</span> <span class="st">&quot;rgb(0, 0, 0)&quot;</span>,
  <span class="dt">totalBackgroundColor =</span> <span class="st">&quot;rgb(192, 192, 192)&quot;</span>,
  <span class="dt">totalColor =</span> <span class="st">&quot;rgb(0, 0, 0)&quot;</span>,
  <span class="dt">borderColor =</span> <span class="st">&quot;rgb(64, 64, 64)&quot;</span>
)
<span class="co"># create the pivot table</span>
<span class="kw">library</span>(pivottabler)
pt &lt;-<span class="st"> </span>PivotTable<span class="op">$</span><span class="kw">new</span>()
pt<span class="op">$</span><span class="kw">addData</span>(bhmtrains)
pt<span class="op">$</span><span class="kw">addColumnDataGroups</span>(<span class="st">&quot;TrainCategory&quot;</span>)
pt<span class="op">$</span><span class="kw">addRowDataGroups</span>(<span class="st">&quot;TOC&quot;</span>)
pt<span class="op">$</span><span class="kw">defineCalculation</span>(<span class="dt">calculationName=</span><span class="st">&quot;TotalTrains&quot;</span>, <span class="dt">summariseExpression=</span><span class="st">&quot;n()&quot;</span>)
<span class="co"># define the theme</span>
theme &lt;-<span class="st"> </span><span class="kw">getSimpleColoredTheme</span>(<span class="dt">parentPivot=</span>pt, <span class="dt">colors=</span>grayColors, <span class="dt">fontName=</span><span class="st">&quot;Courier New, Courier&quot;</span>)
pt<span class="op">$</span>theme &lt;-<span class="st"> </span>theme
pt<span class="op">$</span><span class="kw">renderPivot</span>(<span class="dt">styleNamePrefix=</span><span class="st">&quot;t4&quot;</span>)</code></pre></div>
<div id="htmlwidget-c89e69ca00ce9414f48d" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-c89e69ca00ce9414f48d">{"x":{"tableCss":".t4Table {border-collapse: collapse; border: 2px solid rgb(64, 64, 64); }\r\n.t4ColumnHeader {font-family: Courier New, Courier; font-size: 0.75em; padding: 2px; border: 1px solid rgb(64, 64, 64); vertical-align: middle; text-align: center; font-weight: bold; color: rgb(255, 255, 255); background-color: rgb(128, 128, 128); }\r\n.t4RowHeader {font-family: Courier New, Courier; font-size: 0.75em; padding: 2px 8px 2px 2px; border: 1px solid rgb(64, 64, 64); vertical-align: middle; text-align: left; font-weight: bold; color: rgb(255, 255, 255); background-color: rgb(128, 128, 128); }\r\n.t4Cell {font-family: Courier New, Courier; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid rgb(64, 64, 64); vertical-align: middle; text-align: right; color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); }\r\n.t4Total {font-family: Courier New, Courier; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid rgb(64, 64, 64); vertical-align: middle; text-align: right; color: rgb(0, 0, 0); background-color: rgb(192, 192, 192); }\r\n","tableHtml":"<table class=\"t4Table\">\n  <tr>\n    <th class=\"t4ColumnHeader\" rowspan=\"1\" colspan=\"1\">&nbsp;<\/th>\n    <th class=\"t4ColumnHeader\" colspan=\"1\">Express Passenger<\/th>\n    <th class=\"t4ColumnHeader\" colspan=\"1\">Ordinary Passenger<\/th>\n    <th class=\"t4ColumnHeader\" colspan=\"1\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"t4RowHeader\" rowspan=\"1\">Arriva Trains Wales<\/th>\n    <td class=\"t4Cell\">3079<\/td>\n    <td class=\"t4Cell\">830<\/td>\n    <td class=\"t4Total\">3909<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t4RowHeader\" rowspan=\"1\">CrossCountry<\/th>\n    <td class=\"t4Cell\">22865<\/td>\n    <td class=\"t4Cell\">63<\/td>\n    <td class=\"t4Total\">22928<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t4RowHeader\" rowspan=\"1\">London Midland<\/th>\n    <td class=\"t4Cell\">14487<\/td>\n    <td class=\"t4Cell\">33792<\/td>\n    <td class=\"t4Total\">48279<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t4RowHeader\" rowspan=\"1\">Virgin Trains<\/th>\n    <td class=\"t4Cell\">8594<\/td>\n    <td class=\"t4Cell\"><\/td>\n    <td class=\"t4Total\">8594<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t4RowHeader\" rowspan=\"1\">Total<\/th>\n    <td class=\"t4Total\">49025<\/td>\n    <td class=\"t4Total\">34685<\/td>\n    <td class=\"t4Total\">83710<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define the colours</span>
orangeColors &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">headerBackgroundColor =</span> <span class="st">&quot;rgb(237, 125, 49)&quot;</span>,
  <span class="dt">headerColor =</span> <span class="st">&quot;rgb(255, 255, 255)&quot;</span>,
  <span class="dt">cellBackgroundColor =</span> <span class="st">&quot;rgb(255, 255, 255)&quot;</span>,
  <span class="dt">cellColor =</span> <span class="st">&quot;rgb(0, 0, 0)&quot;</span>,
  <span class="dt">totalBackgroundColor =</span> <span class="st">&quot;rgb(248, 198, 165)&quot;</span>,
  <span class="dt">totalColor =</span> <span class="st">&quot;rgb(0, 0, 0)&quot;</span>,
  <span class="dt">borderColor =</span> <span class="st">&quot;rgb(198, 89, 17)&quot;</span>
)
<span class="co"># create the pivot table</span>
<span class="kw">library</span>(pivottabler)
pt &lt;-<span class="st"> </span>PivotTable<span class="op">$</span><span class="kw">new</span>()
pt<span class="op">$</span><span class="kw">addData</span>(bhmtrains)
pt<span class="op">$</span><span class="kw">addColumnDataGroups</span>(<span class="st">&quot;TrainCategory&quot;</span>)
pt<span class="op">$</span><span class="kw">addRowDataGroups</span>(<span class="st">&quot;TOC&quot;</span>)
pt<span class="op">$</span><span class="kw">defineCalculation</span>(<span class="dt">calculationName=</span><span class="st">&quot;TotalTrains&quot;</span>, <span class="dt">summariseExpression=</span><span class="st">&quot;n()&quot;</span>)
<span class="co"># define the theme</span>
theme &lt;-<span class="st"> </span><span class="kw">getSimpleColoredTheme</span>(<span class="dt">parentPivot=</span>pt, <span class="dt">colors=</span>orangeColors, <span class="dt">fontName=</span><span class="st">&quot;Garamond, arial&quot;</span>)
pt<span class="op">$</span>theme &lt;-<span class="st"> </span>theme
pt<span class="op">$</span><span class="kw">renderPivot</span>(<span class="dt">styleNamePrefix=</span><span class="st">&quot;t5&quot;</span>)</code></pre></div>
<div id="htmlwidget-819aeb9906d6388c7882" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-819aeb9906d6388c7882">{"x":{"tableCss":".t5Table {border-collapse: collapse; border: 2px solid rgb(198, 89, 17); }\r\n.t5ColumnHeader {font-family: Garamond, arial; font-size: 0.75em; padding: 2px; border: 1px solid rgb(198, 89, 17); vertical-align: middle; text-align: center; font-weight: bold; color: rgb(255, 255, 255); background-color: rgb(237, 125, 49); }\r\n.t5RowHeader {font-family: Garamond, arial; font-size: 0.75em; padding: 2px 8px 2px 2px; border: 1px solid rgb(198, 89, 17); vertical-align: middle; text-align: left; font-weight: bold; color: rgb(255, 255, 255); background-color: rgb(237, 125, 49); }\r\n.t5Cell {font-family: Garamond, arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid rgb(198, 89, 17); vertical-align: middle; text-align: right; color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); }\r\n.t5Total {font-family: Garamond, arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid rgb(198, 89, 17); vertical-align: middle; text-align: right; color: rgb(0, 0, 0); background-color: rgb(248, 198, 165); }\r\n","tableHtml":"<table class=\"t5Table\">\n  <tr>\n    <th class=\"t5ColumnHeader\" rowspan=\"1\" colspan=\"1\">&nbsp;<\/th>\n    <th class=\"t5ColumnHeader\" colspan=\"1\">Express Passenger<\/th>\n    <th class=\"t5ColumnHeader\" colspan=\"1\">Ordinary Passenger<\/th>\n    <th class=\"t5ColumnHeader\" colspan=\"1\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"t5RowHeader\" rowspan=\"1\">Arriva Trains Wales<\/th>\n    <td class=\"t5Cell\">3079<\/td>\n    <td class=\"t5Cell\">830<\/td>\n    <td class=\"t5Total\">3909<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t5RowHeader\" rowspan=\"1\">CrossCountry<\/th>\n    <td class=\"t5Cell\">22865<\/td>\n    <td class=\"t5Cell\">63<\/td>\n    <td class=\"t5Total\">22928<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t5RowHeader\" rowspan=\"1\">London Midland<\/th>\n    <td class=\"t5Cell\">14487<\/td>\n    <td class=\"t5Cell\">33792<\/td>\n    <td class=\"t5Total\">48279<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t5RowHeader\" rowspan=\"1\">Virgin Trains<\/th>\n    <td class=\"t5Cell\">8594<\/td>\n    <td class=\"t5Cell\"><\/td>\n    <td class=\"t5Total\">8594<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t5RowHeader\" rowspan=\"1\">Total<\/th>\n    <td class=\"t5Total\">49025<\/td>\n    <td class=\"t5Total\">34685<\/td>\n    <td class=\"t5Total\">83710<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define the colours</span>
greenColors &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">headerBackgroundColor =</span> <span class="st">&quot;rgb(112, 173, 71)&quot;</span>,
  <span class="dt">headerColor =</span> <span class="st">&quot;rgb(255, 255, 255)&quot;</span>,
  <span class="dt">cellBackgroundColor=</span><span class="st">&quot;rgb(255, 255, 255)&quot;</span>,
  <span class="dt">cellColor=</span><span class="st">&quot;rgb(0, 0, 0)&quot;</span>,
  <span class="dt">totalBackgroundColor =</span> <span class="st">&quot;rgb(182, 216, 158)&quot;</span>,
  <span class="dt">totalColor=</span><span class="st">&quot;rgb(0, 0, 0)&quot;</span>,
  <span class="dt">borderColor =</span> <span class="st">&quot;rgb(84, 130, 53)&quot;</span>
)
<span class="co"># create the pivot table</span>
<span class="kw">library</span>(pivottabler)
pt &lt;-<span class="st"> </span>PivotTable<span class="op">$</span><span class="kw">new</span>()
pt<span class="op">$</span><span class="kw">addData</span>(bhmtrains)
pt<span class="op">$</span><span class="kw">addColumnDataGroups</span>(<span class="st">&quot;TrainCategory&quot;</span>)
pt<span class="op">$</span><span class="kw">addRowDataGroups</span>(<span class="st">&quot;TOC&quot;</span>)
pt<span class="op">$</span><span class="kw">defineCalculation</span>(<span class="dt">calculationName=</span><span class="st">&quot;TotalTrains&quot;</span>, <span class="dt">summariseExpression=</span><span class="st">&quot;n()&quot;</span>)
<span class="co"># define the theme</span>
theme &lt;-<span class="st"> </span><span class="kw">getSimpleColoredTheme</span>(<span class="dt">parentPivot=</span>pt, <span class="dt">colors=</span>greenColors, <span class="dt">fontName=</span><span class="st">&quot;Helvetica, arial&quot;</span>)
pt<span class="op">$</span>theme &lt;-<span class="st"> </span>theme
pt<span class="op">$</span><span class="kw">renderPivot</span>(<span class="dt">styleNamePrefix=</span><span class="st">&quot;t6&quot;</span>)</code></pre></div>
<div id="htmlwidget-668ae1703410a7e78cf4" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-668ae1703410a7e78cf4">{"x":{"tableCss":".t6Table {border-collapse: collapse; border: 2px solid rgb(84, 130, 53); }\r\n.t6ColumnHeader {font-family: Helvetica, arial; font-size: 0.75em; padding: 2px; border: 1px solid rgb(84, 130, 53); vertical-align: middle; text-align: center; font-weight: bold; color: rgb(255, 255, 255); background-color: rgb(112, 173, 71); }\r\n.t6RowHeader {font-family: Helvetica, arial; font-size: 0.75em; padding: 2px 8px 2px 2px; border: 1px solid rgb(84, 130, 53); vertical-align: middle; text-align: left; font-weight: bold; color: rgb(255, 255, 255); background-color: rgb(112, 173, 71); }\r\n.t6Cell {font-family: Helvetica, arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid rgb(84, 130, 53); vertical-align: middle; text-align: right; color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); }\r\n.t6Total {font-family: Helvetica, arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid rgb(84, 130, 53); vertical-align: middle; text-align: right; color: rgb(0, 0, 0); background-color: rgb(182, 216, 158); }\r\n","tableHtml":"<table class=\"t6Table\">\n  <tr>\n    <th class=\"t6ColumnHeader\" rowspan=\"1\" colspan=\"1\">&nbsp;<\/th>\n    <th class=\"t6ColumnHeader\" colspan=\"1\">Express Passenger<\/th>\n    <th class=\"t6ColumnHeader\" colspan=\"1\">Ordinary Passenger<\/th>\n    <th class=\"t6ColumnHeader\" colspan=\"1\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"t6RowHeader\" rowspan=\"1\">Arriva Trains Wales<\/th>\n    <td class=\"t6Cell\">3079<\/td>\n    <td class=\"t6Cell\">830<\/td>\n    <td class=\"t6Total\">3909<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t6RowHeader\" rowspan=\"1\">CrossCountry<\/th>\n    <td class=\"t6Cell\">22865<\/td>\n    <td class=\"t6Cell\">63<\/td>\n    <td class=\"t6Total\">22928<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t6RowHeader\" rowspan=\"1\">London Midland<\/th>\n    <td class=\"t6Cell\">14487<\/td>\n    <td class=\"t6Cell\">33792<\/td>\n    <td class=\"t6Total\">48279<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t6RowHeader\" rowspan=\"1\">Virgin Trains<\/th>\n    <td class=\"t6Cell\">8594<\/td>\n    <td class=\"t6Cell\"><\/td>\n    <td class=\"t6Total\">8594<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t6RowHeader\" rowspan=\"1\">Total<\/th>\n    <td class=\"t6Total\">49025<\/td>\n    <td class=\"t6Total\">34685<\/td>\n    <td class=\"t6Total\">83710<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define the colours</span>
yellowColors &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">headerBackgroundColor =</span> <span class="st">&quot;rgb(255, 192, 0)&quot;</span>,
  <span class="dt">headerColor =</span> <span class="st">&quot;rgb(255, 255, 255)&quot;</span>,
  <span class="dt">cellBackgroundColor=</span><span class="st">&quot;rgb(255, 255, 255)&quot;</span>,
  <span class="dt">cellColor=</span><span class="st">&quot;rgb(0, 0, 0)&quot;</span>,
  <span class="dt">totalBackgroundColor =</span> <span class="st">&quot;rgb(255, 242, 204)&quot;</span>,
  <span class="dt">totalColor=</span><span class="st">&quot;rgb(0, 0, 0)&quot;</span>,
  <span class="dt">borderColor =</span> <span class="st">&quot;rgb(255, 192, 0)&quot;</span>
)
<span class="co"># create the pivot table</span>
<span class="kw">library</span>(pivottabler)
pt &lt;-<span class="st"> </span>PivotTable<span class="op">$</span><span class="kw">new</span>()
pt<span class="op">$</span><span class="kw">addData</span>(bhmtrains)
pt<span class="op">$</span><span class="kw">addColumnDataGroups</span>(<span class="st">&quot;TrainCategory&quot;</span>)
pt<span class="op">$</span><span class="kw">addRowDataGroups</span>(<span class="st">&quot;TOC&quot;</span>)
pt<span class="op">$</span><span class="kw">defineCalculation</span>(<span class="dt">calculationName=</span><span class="st">&quot;TotalTrains&quot;</span>, <span class="dt">summariseExpression=</span><span class="st">&quot;n()&quot;</span>)
<span class="co"># define the theme</span>
theme &lt;-<span class="st"> </span><span class="kw">getSimpleColoredTheme</span>(<span class="dt">parentPivot=</span>pt, <span class="dt">colors=</span>yellowColors, <span class="dt">fontName=</span><span class="st">&quot;Verdana&quot;</span>)
pt<span class="op">$</span>theme &lt;-<span class="st"> </span>theme
pt<span class="op">$</span><span class="kw">renderPivot</span>(<span class="dt">styleNamePrefix=</span><span class="st">&quot;t7&quot;</span>)</code></pre></div>
<div id="htmlwidget-4c7269dc5bc4ca37a6df" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-4c7269dc5bc4ca37a6df">{"x":{"tableCss":".t7Table {border-collapse: collapse; border: 2px solid rgb(255, 192, 0); }\r\n.t7ColumnHeader {font-family: Verdana; font-size: 0.75em; padding: 2px; border: 1px solid rgb(255, 192, 0); vertical-align: middle; text-align: center; font-weight: bold; color: rgb(255, 255, 255); background-color: rgb(255, 192, 0); }\r\n.t7RowHeader {font-family: Verdana; font-size: 0.75em; padding: 2px 8px 2px 2px; border: 1px solid rgb(255, 192, 0); vertical-align: middle; text-align: left; font-weight: bold; color: rgb(255, 255, 255); background-color: rgb(255, 192, 0); }\r\n.t7Cell {font-family: Verdana; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid rgb(255, 192, 0); vertical-align: middle; text-align: right; color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); }\r\n.t7Total {font-family: Verdana; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid rgb(255, 192, 0); vertical-align: middle; text-align: right; color: rgb(0, 0, 0); background-color: rgb(255, 242, 204); }\r\n","tableHtml":"<table class=\"t7Table\">\n  <tr>\n    <th class=\"t7ColumnHeader\" rowspan=\"1\" colspan=\"1\">&nbsp;<\/th>\n    <th class=\"t7ColumnHeader\" colspan=\"1\">Express Passenger<\/th>\n    <th class=\"t7ColumnHeader\" colspan=\"1\">Ordinary Passenger<\/th>\n    <th class=\"t7ColumnHeader\" colspan=\"1\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"t7RowHeader\" rowspan=\"1\">Arriva Trains Wales<\/th>\n    <td class=\"t7Cell\">3079<\/td>\n    <td class=\"t7Cell\">830<\/td>\n    <td class=\"t7Total\">3909<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t7RowHeader\" rowspan=\"1\">CrossCountry<\/th>\n    <td class=\"t7Cell\">22865<\/td>\n    <td class=\"t7Cell\">63<\/td>\n    <td class=\"t7Total\">22928<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t7RowHeader\" rowspan=\"1\">London Midland<\/th>\n    <td class=\"t7Cell\">14487<\/td>\n    <td class=\"t7Cell\">33792<\/td>\n    <td class=\"t7Total\">48279<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t7RowHeader\" rowspan=\"1\">Virgin Trains<\/th>\n    <td class=\"t7Cell\">8594<\/td>\n    <td class=\"t7Cell\"><\/td>\n    <td class=\"t7Total\">8594<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t7RowHeader\" rowspan=\"1\">Total<\/th>\n    <td class=\"t7Total\">49025<\/td>\n    <td class=\"t7Total\">34685<\/td>\n    <td class=\"t7Total\">83710<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script>
</div>
<div id="creating-a-new-theme" class="section level2">
<h2>Creating a New Theme</h2>
<p>Since a theme is a collection of styles, creating themes is relatively straightforward. The names of the styles are then assigned to the different types of cells within a pivot table:</p>
<ul>
<li>tableStyle - the name of the style applied to the table (i.e. the HTML <code>&lt;table&gt;</code> element).</li>
<li>rootStyle - the name of the style applied to the empty cell at the top left of the pivot table.</li>
<li>rowHeaderStyle/colHeaderStyle - the name of the style applied to the row/column header cells.</li>
<li>cellStyle - the name of the style applied to the cells in the body of the pivot table.</li>
<li>totalStyle - the name of the style applied to the total cells in the pivot table.</li>
</ul>
<p>E.g. creating a custom theme that displays a mixture of bright colours (a rather ugly bubble-gum theme):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define the theme and styles</span>
createCustomTheme &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">parentPivot=</span><span class="ot">NULL</span>, <span class="dt">themeName=</span><span class="st">&quot;myCustomTheme&quot;</span>) {
  pivotStyles &lt;-<span class="st"> </span>PivotStyles<span class="op">$</span><span class="kw">new</span>(<span class="dt">parentPivot=</span>parentPivot, <span class="dt">themeName=</span>themeName)
  <span class="co"># borders in purple</span>
  pivotStyles<span class="op">$</span><span class="kw">addStyle</span>(<span class="dt">styleName=</span><span class="st">&quot;Table&quot;</span>, <span class="kw">list</span>(
      <span class="st">&quot;border-collapse&quot;</span>=<span class="st">&quot;collapse&quot;</span>,
      <span class="st">&quot;border&quot;</span>=<span class="st">&quot;2px solid #B28DFF&quot;</span>
    ))
  <span class="co"># column headings in pink</span>
  pivotStyles<span class="op">$</span><span class="kw">addStyle</span>(<span class="dt">styleName=</span><span class="st">&quot;ColumnHeader&quot;</span>, <span class="kw">list</span>(
      <span class="st">&quot;font-family&quot;</span>=<span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">Courier New</span><span class="ch">\&quot;</span><span class="st">, Courier, monospace&quot;</span>,
      <span class="st">&quot;font-size&quot;</span>=<span class="st">&quot;0.75em&quot;</span>,
      <span class="st">&quot;font-weight&quot;</span>=<span class="st">&quot;bold&quot;</span>,
      <span class="dt">padding=</span><span class="st">&quot;2px&quot;</span>,
      <span class="st">&quot;border&quot;</span>=<span class="st">&quot;2px solid #B28DFF&quot;</span>,
      <span class="st">&quot;vertical-align&quot;</span>=<span class="st">&quot;middle&quot;</span>,
      <span class="st">&quot;text-align&quot;</span>=<span class="st">&quot;center&quot;</span>,
      <span class="st">&quot;font-weight&quot;</span>=<span class="st">&quot;bold&quot;</span>,
      <span class="dt">color=</span><span class="st">&quot;#DB49AC&quot;</span>,
      <span class="st">&quot;background-color&quot;</span>=<span class="st">&quot;#FFCCF9&quot;</span>,
      <span class="st">&quot;xl-wrap-text&quot;</span>=<span class="st">&quot;wrap&quot;</span>
    ))
  <span class="co"># row headings in blue</span>
  pivotStyles<span class="op">$</span><span class="kw">addStyle</span>(<span class="dt">styleName=</span><span class="st">&quot;RowHeader&quot;</span>, <span class="kw">list</span>(
      <span class="st">&quot;font-family&quot;</span>=<span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">Courier New</span><span class="ch">\&quot;</span><span class="st">, Courier, monospace&quot;</span>,
      <span class="st">&quot;font-size&quot;</span>=<span class="st">&quot;0.75em&quot;</span>,
      <span class="st">&quot;font-weight&quot;</span>=<span class="st">&quot;bold&quot;</span>,
      <span class="dt">padding=</span><span class="st">&quot;2px 8px 2px 2px&quot;</span>,
      <span class="st">&quot;border&quot;</span>=<span class="st">&quot;1px solid #B28DFF&quot;</span>,
      <span class="st">&quot;vertical-align&quot;</span>=<span class="st">&quot;middle&quot;</span>,
      <span class="st">&quot;text-align&quot;</span>=<span class="st">&quot;left&quot;</span>,
      <span class="st">&quot;font-weight&quot;</span>=<span class="st">&quot;bold&quot;</span>,
      <span class="dt">color=</span><span class="st">&quot;#438EC8&quot;</span>,
      <span class="st">&quot;background-color&quot;</span>=<span class="st">&quot;#ACE7FF&quot;</span>,
      <span class="st">&quot;xl-wrap-text&quot;</span>=<span class="st">&quot;wrap&quot;</span>
    ))
  <span class="co"># cells in yellow</span>
  pivotStyles<span class="op">$</span><span class="kw">addStyle</span>(<span class="dt">styleName=</span><span class="st">&quot;Cell&quot;</span>, <span class="kw">list</span>(
      <span class="st">&quot;font-family&quot;</span>=<span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">Courier New</span><span class="ch">\&quot;</span><span class="st">, Courier, monospace&quot;</span>,
      <span class="st">&quot;font-size&quot;</span>=<span class="st">&quot;0.75em&quot;</span>,
      <span class="dt">padding=</span><span class="st">&quot;2px 2px 2px 8px&quot;</span>,
      <span class="st">&quot;border&quot;</span>=<span class="st">&quot;1px solid #B28DFF&quot;</span>,
      <span class="st">&quot;text-align&quot;</span>=<span class="st">&quot;right&quot;</span>,
      <span class="dt">color=</span><span class="st">&quot;#FF800D&quot;</span>,
      <span class="st">&quot;background-color&quot;</span>=<span class="st">&quot;#FFFFD1&quot;</span>
    ))
  <span class="co"># totals in orange</span>
  pivotStyles<span class="op">$</span><span class="kw">addStyle</span>(<span class="dt">styleName=</span><span class="st">&quot;Total&quot;</span>, <span class="kw">list</span>(
      <span class="st">&quot;font-family&quot;</span>=<span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">Courier New</span><span class="ch">\&quot;</span><span class="st">, Courier, monospace&quot;</span>,
      <span class="st">&quot;font-size&quot;</span>=<span class="st">&quot;0.75em&quot;</span>,
      <span class="st">&quot;font-weight&quot;</span>=<span class="st">&quot;bold&quot;</span>,
      <span class="dt">padding=</span><span class="st">&quot;2px 2px 2px 8px&quot;</span>,
      <span class="st">&quot;border&quot;</span>=<span class="st">&quot;1px solid rgb(84, 130, 53)&quot;</span>,
      <span class="st">&quot;text-align&quot;</span>=<span class="st">&quot;right&quot;</span>,
      <span class="dt">color=</span><span class="st">&quot;#3BC6B6&quot;</span>,
      <span class="st">&quot;background-color&quot;</span>=<span class="st">&quot;#BFFCC6&quot;</span>
    ))
  pivotStyles<span class="op">$</span>tableStyle &lt;-<span class="st"> &quot;Table&quot;</span>
  pivotStyles<span class="op">$</span>rootStyle &lt;-<span class="st"> &quot;ColumnHeader&quot;</span>
  pivotStyles<span class="op">$</span>rowHeaderStyle &lt;-<span class="st"> &quot;RowHeader&quot;</span>
  pivotStyles<span class="op">$</span>colHeaderStyle &lt;-<span class="st"> &quot;ColumnHeader&quot;</span>
  pivotStyles<span class="op">$</span>cellStyle &lt;-<span class="st"> &quot;Cell&quot;</span>
  pivotStyles<span class="op">$</span>totalStyle &lt;-<span class="st"> &quot;Total&quot;</span>
  <span class="kw">return</span>(<span class="kw">invisible</span>(pivotStyles))
}
<span class="co"># create the pivot table</span>
<span class="kw">library</span>(pivottabler)
pt &lt;-<span class="st"> </span>PivotTable<span class="op">$</span><span class="kw">new</span>()
pt<span class="op">$</span><span class="kw">addData</span>(bhmtrains)
pt<span class="op">$</span><span class="kw">addColumnDataGroups</span>(<span class="st">&quot;TrainCategory&quot;</span>)
pt<span class="op">$</span><span class="kw">addRowDataGroups</span>(<span class="st">&quot;TOC&quot;</span>)
pt<span class="op">$</span><span class="kw">defineCalculation</span>(<span class="dt">calculationName=</span><span class="st">&quot;TotalTrains&quot;</span>, <span class="dt">summariseExpression=</span><span class="st">&quot;n()&quot;</span>)
pt<span class="op">$</span>theme &lt;-<span class="st"> </span><span class="kw">createCustomTheme</span>(pt)
pt<span class="op">$</span><span class="kw">renderPivot</span>(<span class="dt">styleNamePrefix=</span><span class="st">&quot;t8&quot;</span>)</code></pre></div>
<div id="htmlwidget-6440d6cf508071f38cd6" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-6440d6cf508071f38cd6">{"x":{"tableCss":".t8Table {border-collapse: collapse; border: 2px solid #B28DFF; }\r\n.t8ColumnHeader {font-family: \"Courier New\", Courier, monospace; font-size: 0.75em; font-weight: bold; padding: 2px; border: 2px solid #B28DFF; vertical-align: middle; text-align: center; color: #DB49AC; background-color: #FFCCF9; }\r\n.t8RowHeader {font-family: \"Courier New\", Courier, monospace; font-size: 0.75em; font-weight: bold; padding: 2px 8px 2px 2px; border: 1px solid #B28DFF; vertical-align: middle; text-align: left; color: #438EC8; background-color: #ACE7FF; }\r\n.t8Cell {font-family: \"Courier New\", Courier, monospace; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid #B28DFF; text-align: right; color: #FF800D; background-color: #FFFFD1; }\r\n.t8Total {font-family: \"Courier New\", Courier, monospace; font-size: 0.75em; font-weight: bold; padding: 2px 2px 2px 8px; border: 1px solid rgb(84, 130, 53); text-align: right; color: #3BC6B6; background-color: #BFFCC6; }\r\n","tableHtml":"<table class=\"t8Table\">\n  <tr>\n    <th class=\"t8ColumnHeader\" rowspan=\"1\" colspan=\"1\">&nbsp;<\/th>\n    <th class=\"t8ColumnHeader\" colspan=\"1\">Express Passenger<\/th>\n    <th class=\"t8ColumnHeader\" colspan=\"1\">Ordinary Passenger<\/th>\n    <th class=\"t8ColumnHeader\" colspan=\"1\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"t8RowHeader\" rowspan=\"1\">Arriva Trains Wales<\/th>\n    <td class=\"t8Cell\">3079<\/td>\n    <td class=\"t8Cell\">830<\/td>\n    <td class=\"t8Total\">3909<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t8RowHeader\" rowspan=\"1\">CrossCountry<\/th>\n    <td class=\"t8Cell\">22865<\/td>\n    <td class=\"t8Cell\">63<\/td>\n    <td class=\"t8Total\">22928<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t8RowHeader\" rowspan=\"1\">London Midland<\/th>\n    <td class=\"t8Cell\">14487<\/td>\n    <td class=\"t8Cell\">33792<\/td>\n    <td class=\"t8Total\">48279<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t8RowHeader\" rowspan=\"1\">Virgin Trains<\/th>\n    <td class=\"t8Cell\">8594<\/td>\n    <td class=\"t8Cell\"><\/td>\n    <td class=\"t8Total\">8594<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t8RowHeader\" rowspan=\"1\">Total<\/th>\n    <td class=\"t8Total\">49025<\/td>\n    <td class=\"t8Total\">34685<\/td>\n    <td class=\"t8Total\">83710<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script>
</div>
<div id="changing-the-appearance-of-data-groups" class="section level2">
<h2>Changing the appearance of data groups</h2>
<p>The appearance of sets of data groups can be specified when adding the data groups to the pivot table either by specifying a <code>baseStyleName</code> or by specifying <code>styleDeclarations</code>. If specifying a <code>baseStyleName</code>, the full style must be defined. Alternatively specifying a set of style declarations allows just the style settings of interest to be overriden which tends to be simpler, e.g.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pivottabler)
pt &lt;-<span class="st"> </span>PivotTable<span class="op">$</span><span class="kw">new</span>()
pt<span class="op">$</span><span class="kw">addData</span>(bhmtrains)
pt<span class="op">$</span><span class="kw">addColumnDataGroups</span>(<span class="st">&quot;TrainCategory&quot;</span>, <span class="dt">styleDeclarations=</span><span class="kw">list</span>(<span class="st">&quot;color&quot;</span>=<span class="st">&quot;red&quot;</span>, <span class="st">&quot;font-weight&quot;</span>=<span class="st">&quot;bold&quot;</span>, <span class="st">&quot;background-color&quot;</span>=<span class="st">&quot;yellow&quot;</span>))
pt<span class="op">$</span><span class="kw">addRowDataGroups</span>(<span class="st">&quot;TOC&quot;</span>)
pt<span class="op">$</span><span class="kw">defineCalculation</span>(<span class="dt">calculationName=</span><span class="st">&quot;TotalTrains&quot;</span>, <span class="dt">summariseExpression=</span><span class="st">&quot;n()&quot;</span>)
pt<span class="op">$</span><span class="kw">renderPivot</span>(<span class="dt">styleNamePrefix=</span><span class="st">&quot;tdg&quot;</span>)</code></pre></div>
<div id="htmlwidget-528fe9a97882aec43664" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-528fe9a97882aec43664">{"x":{"tableCss":".tdgTable {border-collapse: collapse; }\r\n.tdgColumnHeader {font-family: Arial; font-size: 0.75em; padding: 2px; border: 1px solid lightgray; vertical-align: middle; text-align: center; font-weight: bold; background-color: #F2F2F2; }\r\n.tdgRowHeader {font-family: Arial; font-size: 0.75em; padding: 2px 8px 2px 2px; border: 1px solid lightgray; vertical-align: middle; text-align: left; font-weight: bold; background-color: #F2F2F2; }\r\n.tdgCell {font-family: Arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid lightgray; vertical-align: middle; text-align: right; }\r\n","tableHtml":"<table class=\"tdgTable\">\n  <tr>\n    <th class=\"tdgRowHeader\" rowspan=\"1\" colspan=\"1\">&nbsp;<\/th>\n    <th class=\"tdgColumnHeader\" style=\"color: red; font-weight: bold; background-color: yellow; \" colspan=\"1\">Express Passenger<\/th>\n    <th class=\"tdgColumnHeader\" style=\"color: red; font-weight: bold; background-color: yellow; \" colspan=\"1\">Ordinary Passenger<\/th>\n    <th class=\"tdgColumnHeader\" style=\"color: red; font-weight: bold; background-color: yellow; \" colspan=\"1\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"tdgRowHeader\" rowspan=\"1\">Arriva Trains Wales<\/th>\n    <td class=\"tdgCell\">3079<\/td>\n    <td class=\"tdgCell\">830<\/td>\n    <td class=\"tdgCell\">3909<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"tdgRowHeader\" rowspan=\"1\">CrossCountry<\/th>\n    <td class=\"tdgCell\">22865<\/td>\n    <td class=\"tdgCell\">63<\/td>\n    <td class=\"tdgCell\">22928<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"tdgRowHeader\" rowspan=\"1\">London Midland<\/th>\n    <td class=\"tdgCell\">14487<\/td>\n    <td class=\"tdgCell\">33792<\/td>\n    <td class=\"tdgCell\">48279<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"tdgRowHeader\" rowspan=\"1\">Virgin Trains<\/th>\n    <td class=\"tdgCell\">8594<\/td>\n    <td class=\"tdgCell\"><\/td>\n    <td class=\"tdgCell\">8594<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"tdgRowHeader\" rowspan=\"1\">Total<\/th>\n    <td class=\"tdgCell\">49025<\/td>\n    <td class=\"tdgCell\">34685<\/td>\n    <td class=\"tdgCell\">83710<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script>
</div>
<div id="changing-the-appearance-of-calculations" class="section level2">
<h2>Changing the appearance of calculations</h2>
<p>The appearance of calculation headings or cell values can be specified when defining the calculations by specifying any combination of <code>headingBaseStyleName</code>, <code>headingStyleDeclarations</code>, <code>cellBaseStyleName</code> and/or <code>cellStyleDeclarations</code>. If specifying a base style name, the full style must be defined. Alternatively specifying a set of style declarations allows just the style settings of interest to be overriden which tends to be simpler. The example below shows both approaches.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pivottabler)
pt &lt;-<span class="st"> </span>PivotTable<span class="op">$</span><span class="kw">new</span>()
pt<span class="op">$</span>styles<span class="op">$</span><span class="kw">addStyle</span>(<span class="dt">styleName=</span><span class="st">&quot;NewHeadingStyle1&quot;</span>, <span class="kw">list</span>(
      <span class="st">&quot;font-family&quot;</span>=<span class="st">&quot;Arial&quot;</span>,
      <span class="st">&quot;font-size&quot;</span>=<span class="st">&quot;0.75em&quot;</span>,
      <span class="dt">padding=</span><span class="st">&quot;2px&quot;</span>,
      <span class="dt">border=</span><span class="st">&quot;1px solid lightgray&quot;</span>,
      <span class="st">&quot;vertical-align&quot;</span>=<span class="st">&quot;middle&quot;</span>,
      <span class="st">&quot;text-align&quot;</span>=<span class="st">&quot;center&quot;</span>,
      <span class="st">&quot;font-weight&quot;</span>=<span class="st">&quot;bold&quot;</span>,
      <span class="st">&quot;background-color&quot;</span>=<span class="st">&quot;Gold&quot;</span>,
      <span class="st">&quot;xl-wrap-text&quot;</span>=<span class="st">&quot;wrap&quot;</span>
    ))
pt<span class="op">$</span>styles<span class="op">$</span><span class="kw">addStyle</span>(<span class="dt">styleName=</span><span class="st">&quot;CellStyle1&quot;</span>, <span class="kw">list</span>(
      <span class="st">&quot;font-family&quot;</span>=<span class="st">&quot;Arial&quot;</span>,
      <span class="st">&quot;font-size&quot;</span>=<span class="st">&quot;0.75em&quot;</span>,
      <span class="dt">padding=</span><span class="st">&quot;2px 2px 2px 8px&quot;</span>,
      <span class="dt">border=</span><span class="st">&quot;1px solid lightgray&quot;</span>,
      <span class="st">&quot;vertical-align&quot;</span>=<span class="st">&quot;middle&quot;</span>,
      <span class="st">&quot;background-color&quot;</span>=<span class="st">&quot;Yellow&quot;</span>,
      <span class="st">&quot;text-align&quot;</span>=<span class="st">&quot;right&quot;</span>
    ))
pt<span class="op">$</span><span class="kw">addData</span>(bhmtrains)
pt<span class="op">$</span><span class="kw">addColumnDataGroups</span>(<span class="st">&quot;TrainCategory&quot;</span>)
pt<span class="op">$</span><span class="kw">addRowDataGroups</span>(<span class="st">&quot;TOC&quot;</span>)
pt<span class="op">$</span><span class="kw">defineCalculation</span>(<span class="dt">calculationName=</span><span class="st">&quot;TotalTrains1&quot;</span>, <span class="dt">summariseExpression=</span><span class="st">&quot;n()&quot;</span>,
                     <span class="dt">headingBaseStyleName=</span><span class="st">&quot;NewHeadingStyle1&quot;</span>, <span class="dt">cellBaseStyleName=</span><span class="st">&quot;CellStyle1&quot;</span>)
pt<span class="op">$</span><span class="kw">defineCalculation</span>(<span class="dt">calculationName=</span><span class="st">&quot;TotalTrains2&quot;</span>, <span class="dt">summariseExpression=</span><span class="st">&quot;n()&quot;</span>,
                     <span class="dt">headingStyleDeclarations=</span><span class="kw">list</span>(<span class="st">&quot;color&quot;</span>=<span class="st">&quot;red&quot;</span>, <span class="st">&quot;font-weight&quot;</span>=<span class="st">&quot;bold&quot;</span>),
                     <span class="dt">cellStyleDeclarations=</span><span class="kw">list</span>(<span class="st">&quot;color&quot;</span>=<span class="st">&quot;blue&quot;</span>))
pt<span class="op">$</span><span class="kw">renderPivot</span>(<span class="dt">styleNamePrefix=</span><span class="st">&quot;tcn&quot;</span>)</code></pre></div>
<div id="htmlwidget-1f86cd47dd433b8b008c" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-1f86cd47dd433b8b008c">{"x":{"tableCss":".tcnTable {border-collapse: collapse; }\r\n.tcnColumnHeader {font-family: Arial; font-size: 0.75em; padding: 2px; border: 1px solid lightgray; vertical-align: middle; text-align: center; font-weight: bold; background-color: #F2F2F2; }\r\n.tcnRowHeader {font-family: Arial; font-size: 0.75em; padding: 2px 8px 2px 2px; border: 1px solid lightgray; vertical-align: middle; text-align: left; font-weight: bold; background-color: #F2F2F2; }\r\n.tcnCell {font-family: Arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid lightgray; vertical-align: middle; text-align: right; }\r\n.tcnNewHeadingStyle1 {font-family: Arial; font-size: 0.75em; padding: 2px; border: 1px solid lightgray; vertical-align: middle; text-align: center; font-weight: bold; background-color: Gold; }\r\n.tcnCellStyle1 {font-family: Arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid lightgray; vertical-align: middle; background-color: Yellow; text-align: right; }\r\n","tableHtml":"<table class=\"tcnTable\">\n  <tr>\n    <th class=\"tcnRowHeader\" rowspan=\"2\" colspan=\"1\">&nbsp;<\/th>\n    <th class=\"tcnColumnHeader\" colspan=\"2\">Express Passenger<\/th>\n    <th class=\"tcnColumnHeader\" colspan=\"2\">Ordinary Passenger<\/th>\n    <th class=\"tcnColumnHeader\" colspan=\"2\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"tcnNewHeadingStyle1\" colspan=\"1\">TotalTrains1<\/th>\n    <th class=\"tcnColumnHeader\" style=\"color: red; font-weight: bold; \" colspan=\"1\">TotalTrains2<\/th>\n    <th class=\"tcnNewHeadingStyle1\" colspan=\"1\">TotalTrains1<\/th>\n    <th class=\"tcnColumnHeader\" style=\"color: red; font-weight: bold; \" colspan=\"1\">TotalTrains2<\/th>\n    <th class=\"tcnNewHeadingStyle1\" colspan=\"1\">TotalTrains1<\/th>\n    <th class=\"tcnColumnHeader\" style=\"color: red; font-weight: bold; \" colspan=\"1\">TotalTrains2<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"tcnRowHeader\" rowspan=\"1\">Arriva Trains Wales<\/th>\n    <td class=\"tcnCellStyle1\">3079<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">3079<\/td>\n    <td class=\"tcnCellStyle1\">830<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">830<\/td>\n    <td class=\"tcnCellStyle1\">3909<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">3909<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"tcnRowHeader\" rowspan=\"1\">CrossCountry<\/th>\n    <td class=\"tcnCellStyle1\">22865<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">22865<\/td>\n    <td class=\"tcnCellStyle1\">63<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">63<\/td>\n    <td class=\"tcnCellStyle1\">22928<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">22928<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"tcnRowHeader\" rowspan=\"1\">London Midland<\/th>\n    <td class=\"tcnCellStyle1\">14487<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">14487<\/td>\n    <td class=\"tcnCellStyle1\">33792<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">33792<\/td>\n    <td class=\"tcnCellStyle1\">48279<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">48279<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"tcnRowHeader\" rowspan=\"1\">Virgin Trains<\/th>\n    <td class=\"tcnCellStyle1\">8594<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">8594<\/td>\n    <td class=\"tcnCellStyle1\"><\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \"><\/td>\n    <td class=\"tcnCellStyle1\">8594<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">8594<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"tcnRowHeader\" rowspan=\"1\">Total<\/th>\n    <td class=\"tcnCellStyle1\">49025<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">49025<\/td>\n    <td class=\"tcnCellStyle1\">34685<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">34685<\/td>\n    <td class=\"tcnCellStyle1\">83710<\/td>\n    <td class=\"tcnCell\" style=\"color: blue; \">83710<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script>
</div>
<div id="changing-the-appearance-of-individual-cells" class="section level2">
<h2>Changing the appearance of individual cells</h2>
<p>The individual cells in the pivot table can have their appearance changed by retrieving the cell then applying a style to the cell. These styles typically apply in addition to the styles coming from the underlying theme, e.g. highlighting a cell:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define the colours</span>
orangeColors &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">headerBackgroundColor =</span> <span class="st">&quot;rgb(237, 125, 49)&quot;</span>,
  <span class="dt">headerColor =</span> <span class="st">&quot;rgb(255, 255, 255)&quot;</span>,
  <span class="dt">cellBackgroundColor =</span> <span class="st">&quot;rgb(255, 255, 255)&quot;</span>,
  <span class="dt">cellColor =</span> <span class="st">&quot;rgb(0, 0, 0)&quot;</span>,
  <span class="dt">totalBackgroundColor =</span> <span class="st">&quot;rgb(248, 198, 165)&quot;</span>,
  <span class="dt">totalColor =</span> <span class="st">&quot;rgb(0, 0, 0)&quot;</span>,
  <span class="dt">borderColor =</span> <span class="st">&quot;rgb(198, 89, 17)&quot;</span>
)
<span class="co"># create the pivot table</span>
<span class="kw">library</span>(pivottabler)
pt &lt;-<span class="st"> </span>PivotTable<span class="op">$</span><span class="kw">new</span>()
pt<span class="op">$</span><span class="kw">addData</span>(bhmtrains)
pt<span class="op">$</span><span class="kw">addColumnDataGroups</span>(<span class="st">&quot;TrainCategory&quot;</span>)
pt<span class="op">$</span><span class="kw">addRowDataGroups</span>(<span class="st">&quot;TOC&quot;</span>)
pt<span class="op">$</span><span class="kw">defineCalculation</span>(<span class="dt">calculationName=</span><span class="st">&quot;TotalTrains&quot;</span>, <span class="dt">summariseExpression=</span><span class="st">&quot;n()&quot;</span>)
<span class="co"># define the theme</span>
theme &lt;-<span class="st"> </span><span class="kw">getSimpleColoredTheme</span>(<span class="dt">parentPivot=</span>pt, <span class="dt">colors=</span>orangeColors, <span class="dt">fontName=</span><span class="st">&quot;Garamond, arial&quot;</span>)
pt<span class="op">$</span>theme &lt;-<span class="st"> </span>theme
<span class="co"># evaluate the pivot to generate the cells</span>
pt<span class="op">$</span><span class="kw">evaluatePivot</span>()
<span class="co"># apply an additional highlight to one cell (3rd row, 2nd column)</span>
cellHighlight &lt;-<span class="st"> </span>pt<span class="op">$</span><span class="kw">createInlineStyle</span>(<span class="dt">declarations=</span><span class="kw">list</span>(<span class="st">&quot;background-color&quot;</span>=<span class="st">&quot;#FFFF00&quot;</span>))
cells &lt;-<span class="st"> </span>pt<span class="op">$</span><span class="kw">getCells</span>(<span class="dt">specifyCellsAsList=</span><span class="ot">TRUE</span>, <span class="dt">cellCoordinates=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>)))
cells[[<span class="dv">1</span>]]<span class="op">$</span>style &lt;-<span class="st"> </span>cellHighlight
<span class="co"># draw the pivot table</span>
pt<span class="op">$</span><span class="kw">renderPivot</span>(<span class="dt">styleNamePrefix=</span><span class="st">&quot;t9&quot;</span>)</code></pre></div>
<div id="htmlwidget-5386e32966334173b982" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-5386e32966334173b982">{"x":{"tableCss":".t9Table {border-collapse: collapse; border: 2px solid rgb(198, 89, 17); }\r\n.t9ColumnHeader {font-family: Garamond, arial; font-size: 0.75em; padding: 2px; border: 1px solid rgb(198, 89, 17); vertical-align: middle; text-align: center; font-weight: bold; color: rgb(255, 255, 255); background-color: rgb(237, 125, 49); }\r\n.t9RowHeader {font-family: Garamond, arial; font-size: 0.75em; padding: 2px 8px 2px 2px; border: 1px solid rgb(198, 89, 17); vertical-align: middle; text-align: left; font-weight: bold; color: rgb(255, 255, 255); background-color: rgb(237, 125, 49); }\r\n.t9Cell {font-family: Garamond, arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid rgb(198, 89, 17); vertical-align: middle; text-align: right; color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); }\r\n.t9Total {font-family: Garamond, arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid rgb(198, 89, 17); vertical-align: middle; text-align: right; color: rgb(0, 0, 0); background-color: rgb(248, 198, 165); }\r\n","tableHtml":"<table class=\"t9Table\">\n  <tr>\n    <th class=\"t9ColumnHeader\" rowspan=\"1\" colspan=\"1\">&nbsp;<\/th>\n    <th class=\"t9ColumnHeader\" colspan=\"1\">Express Passenger<\/th>\n    <th class=\"t9ColumnHeader\" colspan=\"1\">Ordinary Passenger<\/th>\n    <th class=\"t9ColumnHeader\" colspan=\"1\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"t9RowHeader\" rowspan=\"1\">Arriva Trains Wales<\/th>\n    <td class=\"t9Cell\">3079<\/td>\n    <td class=\"t9Cell\">830<\/td>\n    <td class=\"t9Total\">3909<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t9RowHeader\" rowspan=\"1\">CrossCountry<\/th>\n    <td class=\"t9Cell\">22865<\/td>\n    <td class=\"t9Cell\">63<\/td>\n    <td class=\"t9Total\">22928<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t9RowHeader\" rowspan=\"1\">London Midland<\/th>\n    <td class=\"t9Cell\">14487<\/td>\n    <td class=\"t9Cell\" style=\"background-color: #FFFF00; \">33792<\/td>\n    <td class=\"t9Total\">48279<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t9RowHeader\" rowspan=\"1\">Virgin Trains<\/th>\n    <td class=\"t9Cell\">8594<\/td>\n    <td class=\"t9Cell\"><\/td>\n    <td class=\"t9Total\">8594<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"t9RowHeader\" rowspan=\"1\">Total<\/th>\n    <td class=\"t9Total\">49025<\/td>\n    <td class=\"t9Total\">34685<\/td>\n    <td class=\"t9Total\">83710<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script>
<p>In the example above, the default cell style from the theme is still applied. The highlight is applied in addition to the default styling. To stop the base styling being applied, create a new named style and set the baseStyleName property on the cell to the name of the new style.</p>
<p>For many more examples of styling parts of a pivot table, see the <a href="v07-findingandformatting.html">Finding and Formatting</a> vignette.</p>
</div>
<div id="styling-reference" class="section level2">
<h2>Styling Reference</h2>
<p>A reference table of the supported styling declarations can be found in the <a href="vA1-appendix.html">Appendix: Details</a> vignette.</p>
</div>
<div id="further-reading" class="section level2">
<h2>Further Reading</h2>
<p>The full set of vignettes is:</p>
<ol style="list-style-type: decimal">
<li><a href="v01-introduction.html">Introduction</a></li>
<li><a href="v02-datagroups.html">Data Groups</a></li>
<li><a href="v03-calculations.html">Calculations</a></li>
<li><a href="v04-outputs.html">Outputs</a></li>
<li><a href="v05-latexoutput.html">Latex Output</a></li>
<li><a href="v06-styling.html">Styling</a></li>
<li><a href="v07-findingandformatting.html">Finding and Formatting</a></li>
<li><a href="v08-cellcontext.html">Cell Context</a></li>
<li><a href="v09-irregularlayout.html">Irregular Layout</a></li>
<li><a href="v10-performance.html">Performance</a></li>
<li><a href="v11-shiny.html">Shiny</a></li>
<li><a href="v12-excelexport.html">Excel Export</a></li>
<li><a href="vA1-appendix.html">Appendix: Details</a></li>
<li><a href="vA2-appendix.html">Appendix: Calculations</a></li>
<li><a href="vA3-appendix.html">Appendix: Class Overview</a></li>
</ol>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
